<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>core/ngx_string.c - src</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>core/ngx_string.c - src</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L926">ngx_atofp</a></li>
<li><a href="#L898">ngx_atoi</a></li>
<li><a href="#L1000">ngx_atoof</a></li>
<li><a href="#L974">ngx_atosz</a></li>
<li><a href="#L1026">ngx_atotm</a></li>
<li><a href="#L33">ngx_cpystrn</a></li>
<li><a href="#L1167">ngx_decode_base64</a></li>
<li><a href="#L1221">ngx_decode_base64_internal</a></li>
<li><a href="#L1194">ngx_decode_base64url</a></li>
<li><a href="#L827">ngx_dns_strcmp</a></li>
<li><a href="#L1103">ngx_encode_base64</a></li>
<li><a href="#L1123">ngx_encode_base64_internal</a></li>
<li><a href="#L1113">ngx_encode_base64url</a></li>
<li><a href="#L1705">ngx_escape_html</a></li>
<li><a href="#L1777">ngx_escape_json</a></li>
<li><a href="#L1406">ngx_escape_uri</a></li>
<li><a href="#L858">ngx_filename_cmp</a></li>
<li><a href="#L1089">ngx_hex_dump</a></li>
<li><a href="#L1052">ngx_hextoi</a></li>
<li><a href="#L1947">ngx_memcpy</a></li>
<li><a href="#L802">ngx_memn2cmp</a></li>
<li><a href="#L57">ngx_pstrdup</a></li>
<li><a href="#L767">ngx_rstrncasecmp</a></li>
<li><a href="#L744">ngx_rstrncmp</a></li>
<li><a href="#L133">ngx_slprintf</a></li>
<li><a href="#L119">ngx_snprintf</a></li>
<li><a href="#L1914">ngx_sort</a></li>
<li><a href="#L105">ngx_sprintf</a></li>
<li><a href="#L474">ngx_sprintf_num</a></li>
<li><a href="#L1829">ngx_str_rbtree_insert_value</a></li>
<li><a href="#L1869">ngx_str_rbtree_lookup</a></li>
<li><a href="#L567">ngx_strcasecmp</a></li>
<li><a href="#L685">ngx_strcasestrn</a></li>
<li><a href="#L717">ngx_strlcasestrn</a></li>
<li><a href="#L21">ngx_strlow</a></li>
<li><a href="#L593">ngx_strncasecmp</a></li>
<li><a href="#L622">ngx_strnstr</a></li>
<li><a href="#L662">ngx_strstrn</a></li>
<li><a href="#L1575">ngx_unescape_uri</a></li>
<li><a href="#L1360">ngx_utf8_cpystrn</a></li>
<li><a href="#L1276">ngx_utf8_decode</a></li>
<li><a href="#L1333">ngx_utf8_length</a></li>
<li><a href="#L147">ngx_vslprintf</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Copyright (C) Igor Sysoev<br/></li>
<li></span><span class="Comment"> * Copyright (C) Nginx, Inc.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;ngx_config.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ngx_core.h&gt;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<a href="#L474" title="core/ngx_string.c:474">ngx_sprintf_num</a>(u_char *buf, u_char *last, <span class="Type">uint64_t</span> ui64,<br/></li>
<li>&nbsp; &nbsp; u_char zero, <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> hexadecimal, <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> width);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> <a href="#L1123" title="core/ngx_string.c:1123">ngx_encode_base64_internal</a>(<a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *dst, <a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *src,<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> u_char *basis, <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> padding);<br/></li>
<li><span class="Type">static</span> <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L1221" title="core/ngx_string.c:1221">ngx_decode_base64_internal</a>(<a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *dst, <a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *src,<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> u_char *basis);<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L21">&#x200c;</a></span><span class="linkable">ngx_strlow</span>(u_char *dst, u_char *src, <span class="Type">size_t</span> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (n) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *dst = <a href="ngx_string.h.html#L47" title="core/ngx_string.h:47">ngx_tolower</a>(*src);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dst++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; src++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n--;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li>u_char *<br/></li>
<li><a id="L33">&#x200c;</a><span class="linkable">ngx_cpystrn</span>(u_char *dst, u_char *src, <span class="Type">size_t</span> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> dst;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (--n) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *dst = *src;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*dst == <span class="Special">'\0'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> dst;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dst++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; src++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *dst = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> dst;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li>u_char *<br/></li>
<li><a id="L57">&#x200c;</a><span class="linkable">ngx_pstrdup</span>(<a href="ngx_core.h.html#L15" title="core/ngx_core.h:15">ngx_pool_t</a> *pool, <a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *src)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; *dst;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; dst = <a href="ngx_palloc.c.html#L150" title="core/ngx_palloc.c:150">ngx_pnalloc</a>(pool, src-&gt;len);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (dst == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L1947" title="core/ngx_string.c:1947">ngx_memcpy</a>(dst, src-&gt;data, src-&gt;len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> dst;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * supported formats:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %[0][width][x][X]O&nbsp; &nbsp; &nbsp; &nbsp; off_t<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %[0][width]T&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; time_t<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %[0][width][u][x|X]z&nbsp; &nbsp; &nbsp; ssize_t/size_t<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %[0][width][u][x|X]d&nbsp; &nbsp; &nbsp; int/u_int<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %[0][width][u][x|X]l&nbsp; &nbsp; &nbsp; long<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %[0][width|m][u][x|X]i&nbsp; &nbsp; <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>/<a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a><br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %[0][width][u][x|X]D&nbsp; &nbsp; &nbsp; int32_t/uint32_t<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %[0][width][u][x|X]L&nbsp; &nbsp; &nbsp; int64_t/uint64_t<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %[0][width|m][u][x|X]A&nbsp; &nbsp; <a href="../os/unix/ngx_atomic.h.html#L23" title="os/unix/ngx_atomic.h:23">ngx_atomic_int_t</a>/<a href="../os/unix/ngx_atomic.h.html#L24" title="os/unix/ngx_atomic.h:24">ngx_atomic_uint_t</a><br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %[0][width][.width]f&nbsp; &nbsp; &nbsp; double, max valid number fits to %18.15f<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %P&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/unix/ngx_process.h.html#L16" title="os/unix/ngx_process.h:16">ngx_pid_t</a><br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %M&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/unix/ngx_time.h.html#L16" title="os/unix/ngx_time.h:16">ngx_msec_t</a><br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %r&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rlim_t<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %p&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; void *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %V&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %v&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_string.h.html#L37" title="core/ngx_string.h:37">ngx_variable_value_t</a> *<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %s&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; null-terminated string<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %*s&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; length and string<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %Z&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '\0'<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %N&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; '\n'<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %c&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; char<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %%&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; %<br/></li>
<li></span><span class="Comment"> *<br/></li>
<li></span><span class="Comment"> *&nbsp; reserved:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %t&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ptrdiff_t<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %S&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; null-terminated wchar string<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; %C&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; wchar<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li>u_char * <a href="ngx_config.h.html#L73" title="core/ngx_config.h:73">ngx_cdecl</a><br/></li>
<li><a id="L105">&#x200c;</a><span class="linkable">ngx_sprintf</span>(u_char *buf, <span class="Type">const</span> <span class="Type">char</span> *fmt, ...)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp;&nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">va_list</span>&nbsp;&nbsp; args;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; va_start(args, fmt);<br/></li>
<li>&nbsp; &nbsp; p = <a href="#L147" title="core/ngx_string.c:147">ngx_vslprintf</a>(buf, (<span class="Type">void</span> *) -<span class="Constant">1</span>, fmt, args);<br/></li>
<li>&nbsp; &nbsp; va_end(args);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> p;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li>u_char * <a href="ngx_config.h.html#L73" title="core/ngx_config.h:73">ngx_cdecl</a><br/></li>
<li><a id="L119">&#x200c;</a><span class="linkable">ngx_snprintf</span>(u_char *buf, <span class="Type">size_t</span> max, <span class="Type">const</span> <span class="Type">char</span> *fmt, ...)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp;&nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">va_list</span>&nbsp;&nbsp; args;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; va_start(args, fmt);<br/></li>
<li>&nbsp; &nbsp; p = <a href="#L147" title="core/ngx_string.c:147">ngx_vslprintf</a>(buf, buf + max, fmt, args);<br/></li>
<li>&nbsp; &nbsp; va_end(args);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> p;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li>u_char * <a href="ngx_config.h.html#L73" title="core/ngx_config.h:73">ngx_cdecl</a><br/></li>
<li><a id="L133">&#x200c;</a><span class="linkable">ngx_slprintf</span>(u_char *buf, u_char *last, <span class="Type">const</span> <span class="Type">char</span> *fmt, ...)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp;&nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">va_list</span>&nbsp;&nbsp; args;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; va_start(args, fmt);<br/></li>
<li>&nbsp; &nbsp; p = <a href="#L147" title="core/ngx_string.c:147">ngx_vslprintf</a>(buf, last, fmt, args);<br/></li>
<li>&nbsp; &nbsp; va_end(args);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> p;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li>u_char *<br/></li>
<li><a id="L147">&#x200c;</a><span class="linkable">ngx_vslprintf</span>(u_char *buf, u_char *last, <span class="Type">const</span> <span class="Type">char</span> *fmt, <span class="Type">va_list</span> args)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p, zero;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; d;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">double</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; f;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; len, slen;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">int64_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i64;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">uint64_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ui64, frac;<br/></li>
<li>&nbsp; &nbsp; <a href="../os/unix/ngx_time.h.html#L16" title="os/unix/ngx_time.h:16">ngx_msec_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ms;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; width, sign, hex, max_width, frac_width, scale, n;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *v;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.h.html#L37" title="core/ngx_string.h:37">ngx_variable_value_t</a>&nbsp; *vv;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (*fmt &amp;&amp; buf &lt; last) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * &quot;buf &lt; last&quot; means that we could copy at least one character:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * the plain character, &quot;%%&quot;, &quot;%c&quot;, and minus without the checking<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*fmt == <span class="Constant">'%'</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i64 = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ui64 = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zero = (u_char) ((*++fmt == <span class="Constant">'0'</span>) ? <span class="Constant">'0'</span> : <span class="Constant">' '</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; width = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hex = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; max_width = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; frac_width = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slen = (<span class="Type">size_t</span>) -<span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*fmt &gt;= <span class="Constant">'0'</span> &amp;&amp; *fmt &lt;= <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; width = width * <span class="Constant">10</span> + *fmt++ - <span class="Constant">'0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> ( ;; ) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (*fmt) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'u'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmt++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'m'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; max_width = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmt++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'X'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hex = <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmt++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'x'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hex = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmt++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'.'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmt++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*fmt &gt;= <span class="Constant">'0'</span> &amp;&amp; *fmt &lt;= <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; frac_width = frac_width * <span class="Constant">10</span> + *fmt++ - <span class="Constant">'0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'*'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slen = va_arg(args, <span class="Type">size_t</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmt++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (*fmt) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'V'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v = va_arg(args, <a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = <a href="ngx_core.h.html#L91" title="core/ngx_core.h:91">ngx_min</a>(((<span class="Type">size_t</span>) (last - buf)), v-&gt;len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf = <a href="ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(buf, v-&gt;data, len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmt++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'v'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; vv = va_arg(args, <a href="ngx_string.h.html#L37" title="core/ngx_string.h:37">ngx_variable_value_t</a> *);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = <a href="ngx_core.h.html#L91" title="core/ngx_core.h:91">ngx_min</a>(((<span class="Type">size_t</span>) (last - buf)), vv-&gt;len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf = <a href="ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(buf, vv-&gt;data, len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmt++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'s'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = va_arg(args, u_char *);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (slen == (<span class="Type">size_t</span>) -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (*p &amp;&amp; buf &lt; last) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *buf++ = *p++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = <a href="ngx_core.h.html#L91" title="core/ngx_core.h:91">ngx_min</a>(((<span class="Type">size_t</span>) (last - buf)), slen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf = <a href="ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(buf, p, len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmt++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'O'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i64 = (<span class="Type">int64_t</span>) va_arg(args, <span class="Type">off_t</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'P'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i64 = (<span class="Type">int64_t</span>) va_arg(args, <a href="../os/unix/ngx_process.h.html#L16" title="os/unix/ngx_process.h:16">ngx_pid_t</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'T'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i64 = (<span class="Type">int64_t</span>) va_arg(args, <span class="Type">time_t</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'M'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ms = (<a href="../os/unix/ngx_time.h.html#L16" title="os/unix/ngx_time.h:16">ngx_msec_t</a>) va_arg(args, <a href="../os/unix/ngx_time.h.html#L16" title="os/unix/ngx_time.h:16">ngx_msec_t</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((<a href="../os/unix/ngx_time.h.html#L17" title="os/unix/ngx_time.h:17">ngx_msec_int_t</a>) ms == -<span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i64 = -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ui64 = (<span class="Type">uint64_t</span>) ms;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'z'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sign) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i64 = (<span class="Type">int64_t</span>) va_arg(args, <span class="Type">ssize_t</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ui64 = (<span class="Type">uint64_t</span>) va_arg(args, <span class="Type">size_t</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'i'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sign) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i64 = (<span class="Type">int64_t</span>) va_arg(args, <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ui64 = (<span class="Type">uint64_t</span>) va_arg(args, <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (max_width) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; width = <a href="ngx_config.h.html#L87" title="core/ngx_config.h:87">NGX_INT_T_LEN</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'d'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sign) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i64 = (<span class="Type">int64_t</span>) va_arg(args, <span class="Type">int</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ui64 = (<span class="Type">uint64_t</span>) va_arg(args, u_int);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'l'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sign) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i64 = (<span class="Type">int64_t</span>) va_arg(args, <span class="Type">long</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ui64 = (<span class="Type">uint64_t</span>) va_arg(args, u_long);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'D'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sign) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i64 = (<span class="Type">int64_t</span>) va_arg(args, <span class="Type">int32_t</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ui64 = (<span class="Type">uint64_t</span>) va_arg(args, <span class="Type">uint32_t</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'L'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sign) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i64 = va_arg(args, <span class="Type">int64_t</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ui64 = va_arg(args, <span class="Type">uint64_t</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'A'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sign) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i64 = (<span class="Type">int64_t</span>) va_arg(args, <a href="../os/unix/ngx_atomic.h.html#L23" title="os/unix/ngx_atomic.h:23">ngx_atomic_int_t</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ui64 = (<span class="Type">uint64_t</span>) va_arg(args, <a href="../os/unix/ngx_atomic.h.html#L24" title="os/unix/ngx_atomic.h:24">ngx_atomic_uint_t</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (max_width) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; width = <a href="../os/unix/ngx_atomic.h.html#L28" title="os/unix/ngx_atomic.h:28">NGX_ATOMIC_T_LEN</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'f'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f = va_arg(args, <span class="Type">double</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (f &lt; <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *buf++ = <span class="Constant">'-'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f = -f;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ui64 = (<span class="Type">int64_t</span>) f;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; frac = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (frac_width) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scale = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (n = frac_width; n; n--) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scale *= <span class="Constant">10</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; frac = (<span class="Type">uint64_t</span>) ((f - (<span class="Type">double</span>) ui64) * scale + <span class="Constant">0.5</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (frac == scale) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ui64++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; frac = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf = <a href="#L474" title="core/ngx_string.c:474">ngx_sprintf_num</a>(buf, last, ui64, zero, <span class="Constant">0</span>, width);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (frac_width) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (buf &lt; last) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *buf++ = <span class="Constant">'.'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf = <a href="#L474" title="core/ngx_string.c:474">ngx_sprintf_num</a>(buf, last, frac, <span class="Constant">'0'</span>, <span class="Constant">0</span>, frac_width);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmt++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#if !(NGX_WIN32)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'r'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i64 = (<span class="Type">int64_t</span>) va_arg(args, rlim_t);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'p'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ui64 = (<span class="Type">uintptr_t</span>) va_arg(args, <span class="Type">void</span> *);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hex = <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sign = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zero = <span class="Constant">'0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; width = NGX_PTR_SIZE * <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'c'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; d = va_arg(args, <span class="Type">int</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *buf++ = (u_char) (d &amp; <span class="Constant">0xff</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmt++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'Z'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *buf++ = <span class="Special">'\0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmt++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'N'</span>:<br/></li>
<li><span class="PreProc">#if (NGX_WIN32)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *buf++ = <a href="ngx_core.h.html#L85" title="core/ngx_core.h:85">CR</a>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *buf++ = <a href="ngx_core.h.html#L84" title="core/ngx_core.h:84">LF</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmt++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'%'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *buf++ = <span class="Constant">'%'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmt++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *buf++ = *fmt++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sign) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (i64 &lt; <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *buf++ = <span class="Constant">'-'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ui64 = (<span class="Type">uint64_t</span>) -i64;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ui64 = (<span class="Type">uint64_t</span>) i64;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; buf = <a href="#L474" title="core/ngx_string.c:474">ngx_sprintf_num</a>(buf, last, ui64, zero, hex, width);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fmt++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *buf++ = *fmt++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> buf;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> u_char *<br/></li>
<li><a id="L474">&#x200c;</a><span class="linkable">ngx_sprintf_num</span>(u_char *buf, u_char *last, <span class="Type">uint64_t</span> ui64, u_char zero,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> hexadecimal, <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> width)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p, temp[<a href="ngx_config.h.html#L84" title="core/ngx_config.h:84">NGX_INT64_LEN</a> + <span class="Constant">1</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * we need temp[<a href="ngx_config.h.html#L84" title="core/ngx_config.h:84">NGX_INT64_LEN</a>] only,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; * but icc issues the warning<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">uint32_t</span>&nbsp; &nbsp; &nbsp; &nbsp; ui32;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> u_char&nbsp;&nbsp; hex[] = <span class="Constant">&quot;0123456789abcdef&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> u_char&nbsp;&nbsp; HEX[] = <span class="Constant">&quot;0123456789ABCDEF&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = temp + <a href="ngx_config.h.html#L84" title="core/ngx_config.h:84">NGX_INT64_LEN</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (hexadecimal == <span class="Constant">0</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ui64 &lt;= (<span class="Type">uint64_t</span>) <a href="ngx_config.h.html#L126" title="core/ngx_config.h:126">NGX_MAX_UINT32_VALUE</a>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * To divide 64-bit numbers and to find remainders<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * on the x86 platform gcc and icc call the libc functions<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * [u]divdi3() and [u]moddi3(), they call another function<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * in its turn.&nbsp; On FreeBSD it is the qdivrem() function,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * its source code is about 170 lines of the code.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * The glibc counterpart is about 150 lines of the code.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * For 32-bit numbers and some divisors gcc and icc use<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * a inlined multiplication and shifts.&nbsp; For example,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * unsigned &quot;i32 / 10&quot; is compiled to<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *&nbsp; &nbsp;&nbsp; (i32 * 0xCCCCCCCD) &gt;&gt; 35<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ui32 = (<span class="Type">uint32_t</span>) ui64;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">do</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *--p = (u_char) (ui32 % <span class="Constant">10</span> + <span class="Constant">'0'</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">while</span> (ui32 /= <span class="Constant">10</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">do</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *--p = (u_char) (ui64 % <span class="Constant">10</span> + <span class="Constant">'0'</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">while</span> (ui64 /= <span class="Constant">10</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (hexadecimal == <span class="Constant">1</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">do</span> {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* the &quot;(uint32_t)&quot; cast disables the BCC's warning */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *--p = hex[(<span class="Type">uint32_t</span>) (ui64 &amp; <span class="Constant">0xf</span>)];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">while</span> (ui64 &gt;&gt;= <span class="Constant">4</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> { <span class="Comment">/* hexadecimal == 2 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">do</span> {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* the &quot;(uint32_t)&quot; cast disables the BCC's warning */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *--p = HEX[(<span class="Type">uint32_t</span>) (ui64 &amp; <span class="Constant">0xf</span>)];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">while</span> (ui64 &gt;&gt;= <span class="Constant">4</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* zero or space padding */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; len = (temp + <a href="ngx_config.h.html#L84" title="core/ngx_config.h:84">NGX_INT64_LEN</a>) - p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (len++ &lt; width &amp;&amp; buf &lt; last) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *buf++ = zero;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* number safe copy */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; len = (temp + <a href="ngx_config.h.html#L84" title="core/ngx_config.h:84">NGX_INT64_LEN</a>) - p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (buf + len &gt; last) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = last - buf;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_string.h.html#L93" title="core/ngx_string.h:93">ngx_cpymem</a>(buf, p, len);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * We use <a href="#L567" title="core/ngx_string.c:567">ngx_strcasecmp</a>()/<a href="#L593" title="core/ngx_string.c:593">ngx_strncasecmp</a>() for 7-bit ASCII strings only,<br/></li>
<li></span><span class="Comment"> * and implement our own <a href="#L567" title="core/ngx_string.c:567">ngx_strcasecmp</a>()/<a href="#L593" title="core/ngx_string.c:593">ngx_strncasecmp</a>()<br/></li>
<li></span><span class="Comment"> * to avoid libc locale overhead.&nbsp; Besides, we use the <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>'s<br/></li>
<li></span><span class="Comment"> * instead of the u_char's, because they are slightly faster.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L567">&#x200c;</a><span class="linkable">ngx_strcasecmp</span>(u_char *s1, u_char *s2)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; c1, c2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> ( ;; ) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c1 = (<a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>) *s1++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c2 = (<a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>) *s2++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c1 = (c1 &gt;= <span class="Constant">'A'</span> &amp;&amp; c1 &lt;= <span class="Constant">'Z'</span>) ? (c1 | <span class="Constant">0x20</span>) : c1;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c2 = (c2 &gt;= <span class="Constant">'A'</span> &amp;&amp; c2 &lt;= <span class="Constant">'Z'</span>) ? (c2 | <span class="Constant">0x20</span>) : c2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c1 == c2) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c1) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> c1 - c2;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L593">&#x200c;</a><span class="linkable">ngx_strncasecmp</span>(u_char *s1, u_char *s2, <span class="Type">size_t</span> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; c1, c2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (n) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c1 = (<a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>) *s1++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c2 = (<a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>) *s2++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c1 = (c1 &gt;= <span class="Constant">'A'</span> &amp;&amp; c1 &lt;= <span class="Constant">'Z'</span>) ? (c1 | <span class="Constant">0x20</span>) : c1;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c2 = (c2 &gt;= <span class="Constant">'A'</span> &amp;&amp; c2 &lt;= <span class="Constant">'Z'</span>) ? (c2 | <span class="Constant">0x20</span>) : c2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c1 == c2) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c1) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> c1 - c2;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li>u_char *<br/></li>
<li><a id="L622">&#x200c;</a><span class="linkable">ngx_strnstr</span>(u_char *s1, <span class="Type">char</span> *s2, <span class="Type">size_t</span> len)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; c1, c2;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c2 = *(u_char *) s2++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; n = <a href="ngx_string.h.html#L61" title="core/ngx_string.h:61">ngx_strlen</a>(s2);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">do</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">do</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len-- == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c1 = *s1++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c1 == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">while</span> (c1 != c2);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n &gt; len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">while</span> (<a href="ngx_string.h.html#L53" title="core/ngx_string.h:53">ngx_strncmp</a>(s1, (u_char *) s2, n) != <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> --s1;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L662" title="core/ngx_string.c:662">ngx_strstrn</a>() and <a href="#L685" title="core/ngx_string.c:685">ngx_strcasestrn</a>() are intended to search for static<br/></li>
<li></span><span class="Comment"> * substring with known length in null-terminated string. The argument n<br/></li>
<li></span><span class="Comment"> * must be length of the second substring - 1.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li>u_char *<br/></li>
<li><a id="L662">&#x200c;</a><span class="linkable">ngx_strstrn</span>(u_char *s1, <span class="Type">char</span> *s2, <span class="Type">size_t</span> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; c1, c2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c2 = *(u_char *) s2++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">do</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">do</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c1 = *s1++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c1 == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">while</span> (c1 != c2);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">while</span> (<a href="ngx_string.h.html#L53" title="core/ngx_string.h:53">ngx_strncmp</a>(s1, (u_char *) s2, n) != <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> --s1;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li>u_char *<br/></li>
<li><a id="L685">&#x200c;</a><span class="linkable">ngx_strcasestrn</span>(u_char *s1, <span class="Type">char</span> *s2, <span class="Type">size_t</span> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; c1, c2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c2 = (<a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>) *s2++;<br/></li>
<li>&nbsp; &nbsp; c2 = (c2 &gt;= <span class="Constant">'A'</span> &amp;&amp; c2 &lt;= <span class="Constant">'Z'</span>) ? (c2 | <span class="Constant">0x20</span>) : c2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">do</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">do</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c1 = (<a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>) *s1++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c1 == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c1 = (c1 &gt;= <span class="Constant">'A'</span> &amp;&amp; c1 &lt;= <span class="Constant">'Z'</span>) ? (c1 | <span class="Constant">0x20</span>) : c1;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">while</span> (c1 != c2);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">while</span> (<a href="#L593" title="core/ngx_string.c:593">ngx_strncasecmp</a>(s1, (u_char *) s2, n) != <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> --s1;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L717" title="core/ngx_string.c:717">ngx_strlcasestrn</a>() is intended to search for static substring<br/></li>
<li></span><span class="Comment"> * with known length in string until the argument last. The argument n<br/></li>
<li></span><span class="Comment"> * must be length of the second substring - 1.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li>u_char *<br/></li>
<li><a id="L717">&#x200c;</a><span class="linkable">ngx_strlcasestrn</span>(u_char *s1, u_char *last, u_char *s2, <span class="Type">size_t</span> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; c1, c2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; c2 = (<a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>) *s2++;<br/></li>
<li>&nbsp; &nbsp; c2 = (c2 &gt;= <span class="Constant">'A'</span> &amp;&amp; c2 &lt;= <span class="Constant">'Z'</span>) ? (c2 | <span class="Constant">0x20</span>) : c2;<br/></li>
<li>&nbsp; &nbsp; last -= n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">do</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">do</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s1 &gt;= last) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c1 = (<a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>) *s1++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c1 = (c1 &gt;= <span class="Constant">'A'</span> &amp;&amp; c1 &lt;= <span class="Constant">'Z'</span>) ? (c1 | <span class="Constant">0x20</span>) : c1;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">while</span> (c1 != c2);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">while</span> (<a href="#L593" title="core/ngx_string.c:593">ngx_strncasecmp</a>(s1, s2, n) != <span class="Constant">0</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> --s1;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L744">&#x200c;</a><span class="linkable">ngx_rstrncmp</span>(u_char *s1, u_char *s2, <span class="Type">size_t</span> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; n--;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> ( ;; ) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (s1[n] != s2[n]) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> s1[n] - s2[n];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n--;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L767">&#x200c;</a><span class="linkable">ngx_rstrncasecmp</span>(u_char *s1, u_char *s2, <span class="Type">size_t</span> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; c1, c2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; n--;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> ( ;; ) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c1 = s1[n];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c1 &gt;= <span class="Constant">'a'</span> &amp;&amp; c1 &lt;= <span class="Constant">'z'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c1 -= <span class="Constant">'a'</span> - <span class="Constant">'A'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c2 = s2[n];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c2 &gt;= <span class="Constant">'a'</span> &amp;&amp; c2 &lt;= <span class="Constant">'z'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c2 -= <span class="Constant">'a'</span> - <span class="Constant">'A'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c1 != c2) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> c1 - c2;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n--;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L802">&#x200c;</a><span class="linkable">ngx_memn2cmp</span>(u_char *s1, u_char *s2, <span class="Type">size_t</span> n1, <span class="Type">size_t</span> n2)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp;&nbsp; n;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp; m, z;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n1 &lt;= n2) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = n1;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; z = -<span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = n2;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; z = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; m = <a href="ngx_string.h.html#L144" title="core/ngx_string.h:144">ngx_memcmp</a>(s1, s2, n);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (m || n1 == n2) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> m;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> z;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L827">&#x200c;</a><span class="linkable">ngx_dns_strcmp</span>(u_char *s1, u_char *s2)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; c1, c2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> ( ;; ) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c1 = (<a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>) *s1++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c2 = (<a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>) *s2++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c1 = (c1 &gt;= <span class="Constant">'A'</span> &amp;&amp; c1 &lt;= <span class="Constant">'Z'</span>) ? (c1 | <span class="Constant">0x20</span>) : c1;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c2 = (c2 &gt;= <span class="Constant">'A'</span> &amp;&amp; c2 &lt;= <span class="Constant">'Z'</span>) ? (c2 | <span class="Constant">0x20</span>) : c2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c1 == c2) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c1) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* in ASCII '.' &gt; '-', but we need '.' to be the lowest character */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c1 = (c1 == <span class="Constant">'.'</span>) ? <span class="Constant">' '</span> : c1;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c2 = (c2 == <span class="Constant">'.'</span>) ? <span class="Constant">' '</span> : c2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> c1 - c2;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L858">&#x200c;</a><span class="linkable">ngx_filename_cmp</span>(u_char *s1, u_char *s2, <span class="Type">size_t</span> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; c1, c2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (n) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c1 = (<a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>) *s1++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c2 = (<a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>) *s2++;<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (<a href="../os/unix/ngx_files.h.html#L57" title="os/unix/ngx_files.h:57">NGX_HAVE_CASELESS_FILESYSTEM</a>)<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; c1 = tolower(c1);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c2 = tolower(c2);<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c1 == c2) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c1) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* we need '/' to be the lowest character */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c1 == <span class="Constant">0</span> || c2 == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> c1 - c2;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c1 = (c1 == <span class="Constant">'/'</span>) ? <span class="Constant">0</span> : c1;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c2 = (c2 == <span class="Constant">'/'</span>) ? <span class="Constant">0</span> : c2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> c1 - c2;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L898">&#x200c;</a><span class="linkable">ngx_atoi</span>(u_char *line, <span class="Type">size_t</span> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp; value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (value = <span class="Constant">0</span>; n--; line++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*line &lt; <span class="Constant">'0'</span> || *line &gt; <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; value = value * <span class="Constant">10</span> + (*line - <span class="Constant">'0'</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (value &lt; <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> value;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* parse a fixed point number, e.g., <a href="#L926" title="core/ngx_string.c:926">ngx_atofp</a>(&quot;10.5&quot;, 4, 2) returns 1050 */<br/></li>
<li></span><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L926">&#x200c;</a><span class="linkable">ngx_atofp</span>(u_char *line, <span class="Type">size_t</span> n, <span class="Type">size_t</span> point)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp;&nbsp; value;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; dot;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; dot = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (value = <span class="Constant">0</span>; n--; line++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (point == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*line == <span class="Constant">'.'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (dot) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dot = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*line &lt; <span class="Constant">'0'</span> || *line &gt; <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; value = value * <span class="Constant">10</span> + (*line - <span class="Constant">'0'</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; point -= dot;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (point--) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; value = value * <span class="Constant">10</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (value &lt; <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> value;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">ssize_t<br/></li>
<li><a id="L974">&#x200c;</a></span><span class="linkable">ngx_atosz</span>(u_char *line, <span class="Type">size_t</span> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">ssize_t</span>&nbsp; value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (value = <span class="Constant">0</span>; n--; line++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*line &lt; <span class="Constant">'0'</span> || *line &gt; <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; value = value * <span class="Constant">10</span> + (*line - <span class="Constant">'0'</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (value &lt; <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> value;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">off_t<br/></li>
<li><a id="L1000">&#x200c;</a></span><span class="linkable">ngx_atoof</span>(u_char *line, <span class="Type">size_t</span> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">off_t</span>&nbsp; value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (value = <span class="Constant">0</span>; n--; line++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*line &lt; <span class="Constant">'0'</span> || *line &gt; <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; value = value * <span class="Constant">10</span> + (*line - <span class="Constant">'0'</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (value &lt; <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> value;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">time_t<br/></li>
<li><a id="L1026">&#x200c;</a></span><span class="linkable">ngx_atotm</span>(u_char *line, <span class="Type">size_t</span> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">time_t</span>&nbsp; value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (value = <span class="Constant">0</span>; n--; line++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*line &lt; <span class="Constant">'0'</span> || *line &gt; <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; value = value * <span class="Constant">10</span> + (*line - <span class="Constant">'0'</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (value &lt; <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> value;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L1052">&#x200c;</a><span class="linkable">ngx_hextoi</span>(u_char *line, <span class="Type">size_t</span> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp;&nbsp; c, ch;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp; value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (value = <span class="Constant">0</span>; n--; line++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ch = *line;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch &gt;= <span class="Constant">'0'</span> &amp;&amp; ch &lt;= <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value = value * <span class="Constant">16</span> + (ch - <span class="Constant">'0'</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c = (u_char) (ch | <span class="Constant">0x20</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c &gt;= <span class="Constant">'a'</span> &amp;&amp; c &lt;= <span class="Constant">'f'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value = value * <span class="Constant">16</span> + (c - <span class="Constant">'a'</span> + <span class="Constant">10</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (value &lt; <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> value;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li>u_char *<br/></li>
<li><a id="L1089">&#x200c;</a><span class="linkable">ngx_hex_dump</span>(u_char *dst, u_char *src, <span class="Type">size_t</span> len)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> u_char&nbsp; hex[] = <span class="Constant">&quot;0123456789abcdef&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (len--) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *dst++ = hex[*src &gt;&gt; <span class="Constant">4</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *dst++ = hex[*src++ &amp; <span class="Constant">0xf</span>];<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> dst;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1103">&#x200c;</a></span><span class="linkable">ngx_encode_base64</span>(<a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *dst, <a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *src)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> u_char&nbsp;&nbsp; basis64[] =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L1123" title="core/ngx_string.c:1123">ngx_encode_base64_internal</a>(dst, src, basis64, <span class="Constant">1</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1113">&#x200c;</a></span><span class="linkable">ngx_encode_base64url</span>(<a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *dst, <a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *src)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> u_char&nbsp;&nbsp; basis64[] =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="#L1123" title="core/ngx_string.c:1123">ngx_encode_base64_internal</a>(dst, src, basis64, <span class="Constant">0</span>);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void<br/></li>
<li><a id="L1123">&#x200c;</a></span><span class="linkable">ngx_encode_base64_internal</span>(<a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *dst, <a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *src, <span class="Type">const</span> u_char *basis,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> padding)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *d, *s;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; len = src-&gt;len;<br/></li>
<li>&nbsp; &nbsp; s = src-&gt;data;<br/></li>
<li>&nbsp; &nbsp; d = dst-&gt;data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (len &gt; <span class="Constant">2</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *d++ = basis[(s[<span class="Constant">0</span>] &gt;&gt; <span class="Constant">2</span>) &amp; <span class="Constant">0x3f</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *d++ = basis[((s[<span class="Constant">0</span>] &amp; <span class="Constant">3</span>) &lt;&lt; <span class="Constant">4</span>) | (s[<span class="Constant">1</span>] &gt;&gt; <span class="Constant">4</span>)];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *d++ = basis[((s[<span class="Constant">1</span>] &amp; <span class="Constant">0x0f</span>) &lt;&lt; <span class="Constant">2</span>) | (s[<span class="Constant">2</span>] &gt;&gt; <span class="Constant">6</span>)];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *d++ = basis[s[<span class="Constant">2</span>] &amp; <span class="Constant">0x3f</span>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s += <span class="Constant">3</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len -= <span class="Constant">3</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *d++ = basis[(s[<span class="Constant">0</span>] &gt;&gt; <span class="Constant">2</span>) &amp; <span class="Constant">0x3f</span>];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len == <span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *d++ = basis[(s[<span class="Constant">0</span>] &amp; <span class="Constant">3</span>) &lt;&lt; <span class="Constant">4</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (padding) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *d++ = <span class="Constant">'='</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *d++ = basis[((s[<span class="Constant">0</span>] &amp; <span class="Constant">3</span>) &lt;&lt; <span class="Constant">4</span>) | (s[<span class="Constant">1</span>] &gt;&gt; <span class="Constant">4</span>)];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *d++ = basis[(s[<span class="Constant">1</span>] &amp; <span class="Constant">0x0f</span>) &lt;&lt; <span class="Constant">2</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (padding) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *d++ = <span class="Constant">'='</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; dst-&gt;len = d - dst-&gt;data;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L1167">&#x200c;</a><span class="linkable">ngx_decode_base64</span>(<a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *dst, <a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *src)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> u_char&nbsp;&nbsp; basis64[] = {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">62</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">63</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">52</span>, <span class="Constant">53</span>, <span class="Constant">54</span>, <span class="Constant">55</span>, <span class="Constant">56</span>, <span class="Constant">57</span>, <span class="Constant">58</span>, <span class="Constant">59</span>, <span class="Constant">60</span>, <span class="Constant">61</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>,&nbsp; <span class="Constant">0</span>,&nbsp; <span class="Constant">1</span>,&nbsp; <span class="Constant">2</span>,&nbsp; <span class="Constant">3</span>,&nbsp; <span class="Constant">4</span>,&nbsp; <span class="Constant">5</span>,&nbsp; <span class="Constant">6</span>,&nbsp; <span class="Constant">7</span>,&nbsp; <span class="Constant">8</span>,&nbsp; <span class="Constant">9</span>, <span class="Constant">10</span>, <span class="Constant">11</span>, <span class="Constant">12</span>, <span class="Constant">13</span>, <span class="Constant">14</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">15</span>, <span class="Constant">16</span>, <span class="Constant">17</span>, <span class="Constant">18</span>, <span class="Constant">19</span>, <span class="Constant">20</span>, <span class="Constant">21</span>, <span class="Constant">22</span>, <span class="Constant">23</span>, <span class="Constant">24</span>, <span class="Constant">25</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">26</span>, <span class="Constant">27</span>, <span class="Constant">28</span>, <span class="Constant">29</span>, <span class="Constant">30</span>, <span class="Constant">31</span>, <span class="Constant">32</span>, <span class="Constant">33</span>, <span class="Constant">34</span>, <span class="Constant">35</span>, <span class="Constant">36</span>, <span class="Constant">37</span>, <span class="Constant">38</span>, <span class="Constant">39</span>, <span class="Constant">40</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">41</span>, <span class="Constant">42</span>, <span class="Constant">43</span>, <span class="Constant">44</span>, <span class="Constant">45</span>, <span class="Constant">46</span>, <span class="Constant">47</span>, <span class="Constant">48</span>, <span class="Constant">49</span>, <span class="Constant">50</span>, <span class="Constant">51</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77<br/></li>
<li></span>&nbsp; &nbsp; };<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1221" title="core/ngx_string.c:1221">ngx_decode_base64_internal</a>(dst, src, basis64);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L1194">&#x200c;</a><span class="linkable">ngx_decode_base64url</span>(<a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *dst, <a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *src)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> u_char&nbsp;&nbsp; basis64[] = {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">62</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">52</span>, <span class="Constant">53</span>, <span class="Constant">54</span>, <span class="Constant">55</span>, <span class="Constant">56</span>, <span class="Constant">57</span>, <span class="Constant">58</span>, <span class="Constant">59</span>, <span class="Constant">60</span>, <span class="Constant">61</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>,&nbsp; <span class="Constant">0</span>,&nbsp; <span class="Constant">1</span>,&nbsp; <span class="Constant">2</span>,&nbsp; <span class="Constant">3</span>,&nbsp; <span class="Constant">4</span>,&nbsp; <span class="Constant">5</span>,&nbsp; <span class="Constant">6</span>,&nbsp; <span class="Constant">7</span>,&nbsp; <span class="Constant">8</span>,&nbsp; <span class="Constant">9</span>, <span class="Constant">10</span>, <span class="Constant">11</span>, <span class="Constant">12</span>, <span class="Constant">13</span>, <span class="Constant">14</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">15</span>, <span class="Constant">16</span>, <span class="Constant">17</span>, <span class="Constant">18</span>, <span class="Constant">19</span>, <span class="Constant">20</span>, <span class="Constant">21</span>, <span class="Constant">22</span>, <span class="Constant">23</span>, <span class="Constant">24</span>, <span class="Constant">25</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">63</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">26</span>, <span class="Constant">27</span>, <span class="Constant">28</span>, <span class="Constant">29</span>, <span class="Constant">30</span>, <span class="Constant">31</span>, <span class="Constant">32</span>, <span class="Constant">33</span>, <span class="Constant">34</span>, <span class="Constant">35</span>, <span class="Constant">36</span>, <span class="Constant">37</span>, <span class="Constant">38</span>, <span class="Constant">39</span>, <span class="Constant">40</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">41</span>, <span class="Constant">42</span>, <span class="Constant">43</span>, <span class="Constant">44</span>, <span class="Constant">45</span>, <span class="Constant">46</span>, <span class="Constant">47</span>, <span class="Constant">48</span>, <span class="Constant">49</span>, <span class="Constant">50</span>, <span class="Constant">51</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77</span>, <span class="Constant">77<br/></li>
<li></span>&nbsp; &nbsp; };<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L1221" title="core/ngx_string.c:1221">ngx_decode_base64_internal</a>(dst, src, basis64);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L1221">&#x200c;</a><span class="linkable">ngx_decode_base64_internal</span>(<a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *dst, <a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *src, <span class="Type">const</span> u_char *basis)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len;<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *d, *s;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (len = <span class="Constant">0</span>; len &lt; src-&gt;len; len++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (src-&gt;data[len] == <span class="Constant">'='</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (basis[src-&gt;data[len]] == <span class="Constant">77</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (len % <span class="Constant">4</span> == <span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; s = src-&gt;data;<br/></li>
<li>&nbsp; &nbsp; d = dst-&gt;data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (len &gt; <span class="Constant">3</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *d++ = (u_char) (basis[s[<span class="Constant">0</span>]] &lt;&lt; <span class="Constant">2</span> | basis[s[<span class="Constant">1</span>]] &gt;&gt; <span class="Constant">4</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *d++ = (u_char) (basis[s[<span class="Constant">1</span>]] &lt;&lt; <span class="Constant">4</span> | basis[s[<span class="Constant">2</span>]] &gt;&gt; <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *d++ = (u_char) (basis[s[<span class="Constant">2</span>]] &lt;&lt; <span class="Constant">6</span> | basis[s[<span class="Constant">3</span>]]);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; s += <span class="Constant">4</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len -= <span class="Constant">4</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (len &gt; <span class="Constant">1</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *d++ = (u_char) (basis[s[<span class="Constant">0</span>]] &lt;&lt; <span class="Constant">2</span> | basis[s[<span class="Constant">1</span>]] &gt;&gt; <span class="Constant">4</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (len &gt; <span class="Constant">2</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *d++ = (u_char) (basis[s[<span class="Constant">1</span>]] &lt;&lt; <span class="Constant">4</span> | basis[s[<span class="Constant">2</span>]] &gt;&gt; <span class="Constant">2</span>);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; dst-&gt;len = d - dst-&gt;data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * <a href="#L1276" title="core/ngx_string.c:1276">ngx_utf8_decode</a>() decodes two and more bytes UTF sequences only<br/></li>
<li></span><span class="Comment"> * the return values:<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; 0x80 - 0x10ffff&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; valid character<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; 0x110000 - 0xfffffffd&nbsp;&nbsp; invalid sequence<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; 0xfffffffe&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; incomplete sequence<br/></li>
<li></span><span class="Comment"> *&nbsp; &nbsp; 0xffffffff&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; error<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><span class="Type">uint32_t<br/></li>
<li><a id="L1276">&#x200c;</a></span><span class="linkable">ngx_utf8_decode</span>(u_char **p, <span class="Type">size_t</span> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; len;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">uint32_t</span>&nbsp; u, i, valid;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; u = **p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (u &gt;= <span class="Constant">0xf0</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u &amp;= <span class="Constant">0x07</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; valid = <span class="Constant">0xffff</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Constant">3</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (u &gt;= <span class="Constant">0xe0</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u &amp;= <span class="Constant">0x0f</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; valid = <span class="Constant">0x7ff</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Constant">2</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (u &gt;= <span class="Constant">0xc2</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u &amp;= <span class="Constant">0x1f</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; valid = <span class="Constant">0x7f</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (*p)++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0xffffffff</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n - <span class="Constant">1</span> &lt; len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0xfffffffe</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; (*p)++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; i = *(*p)++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (i &lt; <span class="Constant">0x80</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0xffffffff</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u = (u &lt;&lt; <span class="Constant">6</span>) | (i &amp; <span class="Constant">0x3f</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len--;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (u &gt; valid) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> u;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0xffffffff</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">size_t<br/></li>
<li><a id="L1333">&#x200c;</a></span><span class="linkable">ngx_utf8_length</span>(u_char *p, <span class="Type">size_t</span> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; c, *last;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; last = p + n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (len = <span class="Constant">0</span>; p &lt; last; len++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c = *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c &lt; <span class="Constant">0x80</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L1276" title="core/ngx_string.c:1276">ngx_utf8_decode</a>(&amp;p, n) &gt; <span class="Constant">0x10ffff</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* invalid UTF-8 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> n;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> len;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li>u_char *<br/></li>
<li><a id="L1360">&#x200c;</a><span class="linkable">ngx_utf8_cpystrn</span>(u_char *dst, u_char *src, <span class="Type">size_t</span> n, <span class="Type">size_t</span> len)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; c, *next;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> dst;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (--n) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c = *src;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *dst = c;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c &lt; <span class="Constant">0x80</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c != <span class="Special">'\0'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dst++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; src++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len--;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> dst;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; next = src;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L1276" title="core/ngx_string.c:1276">ngx_utf8_decode</a>(&amp;next, len) &gt; <span class="Constant">0x10ffff</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* invalid UTF-8 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (src &lt; next) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = *src++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *dst = <span class="Special">'\0'</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> dst;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">uintptr_t<br/></li>
<li><a id="L1406">&#x200c;</a></span><span class="linkable">ngx_escape_uri</span>(u_char *dst, u_char *src, <span class="Type">size_t</span> size, <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> type)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; n;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">uint32_t</span>&nbsp; &nbsp; &nbsp;&nbsp; *escape;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> u_char&nbsp;&nbsp; hex[] = <span class="Constant">&quot;0123456789ABCDEF&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* &quot; &quot;, &quot;#&quot;, &quot;%&quot;, &quot;?&quot;, %00-%1F, %7F-%FF */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> <span class="Type">uint32_t</span>&nbsp;&nbsp; uri[] = {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* ?&gt;=&lt; ;:98 7654 3210&nbsp; /.-, +*)( '&amp;%$ #&quot;!&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x80000029</span>, <span class="Comment">/* 1000 0000 0000 0000&nbsp; 0000 0000 0010 1001 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* _^]\ [ZYX WVUT SRQP&nbsp; ONML KJIH GFED CBA@ */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x00000000</span>, <span class="Comment">/* 0000 0000 0000 0000&nbsp; 0000 0000 0000 0000 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*&nbsp; ~}| {zyx wvut srqp&nbsp; onml kjih gfed cba` */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x80000000</span>, <span class="Comment">/* 1000 0000 0000 0000&nbsp; 0000 0000 0000 0000 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>&nbsp; <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; };<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* &quot; &quot;, &quot;#&quot;, &quot;%&quot;, &quot;&amp;&quot;, &quot;+&quot;, &quot;?&quot;, %00-%1F, %7F-%FF */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> <span class="Type">uint32_t</span>&nbsp;&nbsp; args[] = {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* ?&gt;=&lt; ;:98 7654 3210&nbsp; /.-, +*)( '&amp;%$ #&quot;!&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x88000869</span>, <span class="Comment">/* 1000 1000 0000 0000&nbsp; 0000 1000 0110 1001 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* _^]\ [ZYX WVUT SRQP&nbsp; ONML KJIH GFED CBA@ */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x00000000</span>, <span class="Comment">/* 0000 0000 0000 0000&nbsp; 0000 0000 0000 0000 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*&nbsp; ~}| {zyx wvut srqp&nbsp; onml kjih gfed cba` */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x80000000</span>, <span class="Comment">/* 1000 0000 0000 0000&nbsp; 0000 0000 0000 0000 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>&nbsp; <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; };<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* not ALPHA, DIGIT, &quot;-&quot;, &quot;.&quot;, &quot;_&quot;, &quot;~&quot; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> <span class="Type">uint32_t</span>&nbsp;&nbsp; uri_component[] = {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* ?&gt;=&lt; ;:98 7654 3210&nbsp; /.-, +*)( '&amp;%$ #&quot;!&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xfc009fff</span>, <span class="Comment">/* 1111 1100 0000 0000&nbsp; 1001 1111 1111 1111 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* _^]\ [ZYX WVUT SRQP&nbsp; ONML KJIH GFED CBA@ */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x78000001</span>, <span class="Comment">/* 0111 1000 0000 0000&nbsp; 0000 0000 0000 0001 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*&nbsp; ~}| {zyx wvut srqp&nbsp; onml kjih gfed cba` */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xb8000001</span>, <span class="Comment">/* 1011 1000 0000 0000&nbsp; 0000 0000 0000 0001 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>&nbsp; <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; };<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* &quot; &quot;, &quot;#&quot;, &quot;&quot;&quot;, &quot;%&quot;, &quot;'&quot;, %00-%1F, %7F-%FF */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> <span class="Type">uint32_t</span>&nbsp;&nbsp; html[] = {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* ?&gt;=&lt; ;:98 7654 3210&nbsp; /.-, +*)( '&amp;%$ #&quot;!&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x000000ad</span>, <span class="Comment">/* 0000 0000 0000 0000&nbsp; 0000 0000 1010 1101 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* _^]\ [ZYX WVUT SRQP&nbsp; ONML KJIH GFED CBA@ */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x00000000</span>, <span class="Comment">/* 0000 0000 0000 0000&nbsp; 0000 0000 0000 0000 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*&nbsp; ~}| {zyx wvut srqp&nbsp; onml kjih gfed cba` */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x80000000</span>, <span class="Comment">/* 1000 0000 0000 0000&nbsp; 0000 0000 0000 0000 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>&nbsp; <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; };<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* &quot; &quot;, &quot;&quot;&quot;, &quot;%&quot;, &quot;'&quot;, %00-%1F, %7F-%FF */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> <span class="Type">uint32_t</span>&nbsp;&nbsp; refresh[] = {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* ?&gt;=&lt; ;:98 7654 3210&nbsp; /.-, +*)( '&amp;%$ #&quot;!&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x00000085</span>, <span class="Comment">/* 0000 0000 0000 0000&nbsp; 0000 0000 1000 0101 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* _^]\ [ZYX WVUT SRQP&nbsp; ONML KJIH GFED CBA@ */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x00000000</span>, <span class="Comment">/* 0000 0000 0000 0000&nbsp; 0000 0000 0000 0000 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*&nbsp; ~}| {zyx wvut srqp&nbsp; onml kjih gfed cba` */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x80000000</span>, <span class="Comment">/* 1000 0000 0000 0000&nbsp; 0000 0000 0000 0000 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>&nbsp; <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span>&nbsp; &nbsp; };<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* &quot; &quot;, &quot;%&quot;, %00-%1F */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> <span class="Type">uint32_t</span>&nbsp;&nbsp; memcached[] = {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0xffffffff</span>, <span class="Comment">/* 1111 1111 1111 1111&nbsp; 1111 1111 1111 1111 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* ?&gt;=&lt; ;:98 7654 3210&nbsp; /.-, +*)( '&amp;%$ #&quot;!&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x00000021</span>, <span class="Comment">/* 0000 0000 0000 0000&nbsp; 0000 0000 0010 0001 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* _^]\ [ZYX WVUT SRQP&nbsp; ONML KJIH GFED CBA@ */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x00000000</span>, <span class="Comment">/* 0000 0000 0000 0000&nbsp; 0000 0000 0000 0000 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*&nbsp; ~}| {zyx wvut srqp&nbsp; onml kjih gfed cba` */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x00000000</span>, <span class="Comment">/* 0000 0000 0000 0000&nbsp; 0000 0000 0000 0000 */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x00000000</span>, <span class="Comment">/* 0000 0000 0000 0000&nbsp; 0000 0000 0000 0000 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x00000000</span>, <span class="Comment">/* 0000 0000 0000 0000&nbsp; 0000 0000 0000 0000 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x00000000</span>, <span class="Comment">/* 0000 0000 0000 0000&nbsp; 0000 0000 0000 0000 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Constant">0x00000000</span>, <span class="Comment">/* 0000 0000 0000 0000&nbsp; 0000 0000 0000 0000 */<br/></li>
<li></span>&nbsp; &nbsp; };<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* mail_auth is the same as memcached */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Type">static</span> <span class="Type">uint32_t</span>&nbsp; *map[] =<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; { uri, args, uri_component, html, refresh, memcached, memcached };<br/></li>
<li><br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; escape = map[type];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (dst == <span class="Constant">NULL</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* find the number of the characters to be escaped */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (size) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (escape[*src &gt;&gt; <span class="Constant">5</span>] &amp; (<span class="Constant">1</span> &lt;&lt; (*src &amp; <span class="Constant">0x1f</span>))) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; src++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; size--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> (<span class="Type">uintptr_t</span>) n;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (size) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (escape[*src &gt;&gt; <span class="Constant">5</span>] &amp; (<span class="Constant">1</span> &lt;&lt; (*src &amp; <span class="Constant">0x1f</span>))) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <span class="Constant">'%'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = hex[*src &gt;&gt; <span class="Constant">4</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = hex[*src &amp; <span class="Constant">0xf</span>];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; src++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = *src++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; size--;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (<span class="Type">uintptr_t</span>) dst;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1575">&#x200c;</a></span><span class="linkable">ngx_unescape_uri</span>(u_char **dst, u_char **src, <span class="Type">size_t</span> size, <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> type)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; *d, *s, ch, c, decoded;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">enum</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sw_usual = <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sw_quoted,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sw_quoted_second<br/></li>
<li>&nbsp; &nbsp; } state;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; d = *dst;<br/></li>
<li>&nbsp; &nbsp; s = *src;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; state = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; decoded = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (size--) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ch = *s++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (state) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> sw_usual:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Constant">'?'<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; (type &amp; (<a href="ngx_string.h.html#L203" title="core/ngx_string.h:203">NGX_UNESCAPE_URI</a>|<a href="ngx_string.h.html#L204" title="core/ngx_string.h:204">NGX_UNESCAPE_REDIRECT</a>)))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *d++ = ch;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> done;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Constant">'%'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = sw_quoted;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *d++ = ch;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> sw_quoted:<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch &gt;= <span class="Constant">'0'</span> &amp;&amp; ch &lt;= <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; decoded = (u_char) (ch - <span class="Constant">'0'</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = sw_quoted_second;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c = (u_char) (ch | <span class="Constant">0x20</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c &gt;= <span class="Constant">'a'</span> &amp;&amp; c &lt;= <span class="Constant">'f'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; decoded = (u_char) (c - <span class="Constant">'a'</span> + <span class="Constant">10</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = sw_quoted_second;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* the invalid quoted character */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = sw_usual;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *d++ = ch;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> sw_quoted_second:<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; state = sw_usual;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch &gt;= <span class="Constant">'0'</span> &amp;&amp; ch &lt;= <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ch = (u_char) ((decoded &lt;&lt; <span class="Constant">4</span>) + ch - <span class="Constant">'0'</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (type &amp; <a href="ngx_string.h.html#L204" title="core/ngx_string.h:204">NGX_UNESCAPE_REDIRECT</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch &gt; <span class="Constant">'%'</span> &amp;&amp; ch &lt; <span class="Constant">0x7f</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *d++ = ch;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *d++ = <span class="Constant">'%'</span>; *d++ = *(s - <span class="Constant">2</span>); *d++ = *(s - <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *d++ = ch;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c = (u_char) (ch | <span class="Constant">0x20</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c &gt;= <span class="Constant">'a'</span> &amp;&amp; c &lt;= <span class="Constant">'f'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ch = (u_char) ((decoded &lt;&lt; <span class="Constant">4</span>) + c - <span class="Constant">'a'</span> + <span class="Constant">10</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (type &amp; <a href="ngx_string.h.html#L203" title="core/ngx_string.h:203">NGX_UNESCAPE_URI</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Constant">'?'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *d++ = ch;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> done;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *d++ = ch;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (type &amp; <a href="ngx_string.h.html#L204" title="core/ngx_string.h:204">NGX_UNESCAPE_REDIRECT</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Constant">'?'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *d++ = ch;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> done;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch &gt; <span class="Constant">'%'</span> &amp;&amp; ch &lt; <span class="Constant">0x7f</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *d++ = ch;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *d++ = <span class="Constant">'%'</span>; *d++ = *(s - <span class="Constant">2</span>); *d++ = *(s - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *d++ = ch;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* the invalid quoted character */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="Statement">done</span><span class="cUserCont">:<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; *dst = d;<br/></li>
<li>&nbsp; &nbsp; *src = s;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">uintptr_t<br/></li>
<li><a id="L1705">&#x200c;</a></span><span class="linkable">ngx_escape_html</span>(u_char *dst, u_char *src, <span class="Type">size_t</span> size)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; ch;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (dst == <span class="Constant">NULL</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (size) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (*src++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'&lt;'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;&amp;lt;&quot;</span>) - <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'&gt;'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;&amp;gt;&quot;</span>) - <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'&amp;'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;&amp;amp;&quot;</span>) - <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'&quot;'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;&amp;quot;&quot;</span>) - <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; size--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> (<span class="Type">uintptr_t</span>) len;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (size) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ch = *src++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (ch) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'&lt;'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <span class="Constant">'&amp;'</span>; *dst++ = <span class="Constant">'l'</span>; *dst++ = <span class="Constant">'t'</span>; *dst++ = <span class="Constant">';'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'&gt;'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <span class="Constant">'&amp;'</span>; *dst++ = <span class="Constant">'g'</span>; *dst++ = <span class="Constant">'t'</span>; *dst++ = <span class="Constant">';'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'&amp;'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <span class="Constant">'&amp;'</span>; *dst++ = <span class="Constant">'a'</span>; *dst++ = <span class="Constant">'m'</span>; *dst++ = <span class="Constant">'p'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <span class="Constant">';'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> <span class="Constant">'&quot;'</span>:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <span class="Constant">'&amp;'</span>; *dst++ = <span class="Constant">'q'</span>; *dst++ = <span class="Constant">'u'</span>; *dst++ = <span class="Constant">'o'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <span class="Constant">'t'</span>; *dst++ = <span class="Constant">';'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = ch;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; size--;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (<span class="Type">uintptr_t</span>) dst;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">uintptr_t<br/></li>
<li><a id="L1777">&#x200c;</a></span><span class="linkable">ngx_escape_json</span>(u_char *dst, u_char *src, <span class="Type">size_t</span> size)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; ch;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (dst == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (size) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ch = *src++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Special">'\\'</span> || ch == <span class="Constant">'&quot;'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (ch &lt;= <span class="Constant">0x1f</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len += <span class="Statement">sizeof</span>(<span class="Constant">&quot;</span><span class="Special">\\</span><span class="Constant">u001F&quot;</span>) - <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; size--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> (<span class="Type">uintptr_t</span>) len;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (size) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ch = *src++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch &gt; <span class="Constant">0x1f</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (ch == <span class="Special">'\\'</span> || ch == <span class="Constant">'&quot;'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <span class="Special">'\\'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = ch;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <span class="Special">'\\'</span>; *dst++ = <span class="Constant">'u'</span>; *dst++ = <span class="Constant">'0'</span>; *dst++ = <span class="Constant">'0'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <span class="Constant">'0'</span> + (ch &gt;&gt; <span class="Constant">4</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ch &amp;= <span class="Constant">0xf</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = (ch &lt; <span class="Constant">10</span>) ? (<span class="Constant">'0'</span> + ch) : (<span class="Constant">'A'</span> + ch - <span class="Constant">10</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; size--;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (<span class="Type">uintptr_t</span>) dst;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1829">&#x200c;</a></span><span class="linkable">ngx_str_rbtree_insert_value</span>(<a href="ngx_rbtree.h.html#L20" title="core/ngx_rbtree.h:20">ngx_rbtree_node_t</a> *temp,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_rbtree.h.html#L20" title="core/ngx_rbtree.h:20">ngx_rbtree_node_t</a> *node, <a href="ngx_rbtree.h.html#L20" title="core/ngx_rbtree.h:20">ngx_rbtree_node_t</a> *sentinel)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.h.html#L216" title="core/ngx_string.h:216">ngx_str_node_t</a>&nbsp; &nbsp; &nbsp; *n, *t;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_rbtree.h.html#L20" title="core/ngx_rbtree.h:20">ngx_rbtree_node_t</a>&nbsp; **p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> ( ;; ) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = (<a href="ngx_string.h.html#L216" title="core/ngx_string.h:216">ngx_str_node_t</a> *) node;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; t = (<a href="ngx_string.h.html#L216" title="core/ngx_string.h:216">ngx_str_node_t</a> *) temp;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (node-&gt;key != temp-&gt;key) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = (node-&gt;key &lt; temp-&gt;key) ? &amp;temp-&gt;left : &amp;temp-&gt;right;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (n-&gt;str.len != t-&gt;str.len) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = (n-&gt;str.len &lt; t-&gt;str.len) ? &amp;temp-&gt;left : &amp;temp-&gt;right;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = (<a href="ngx_string.h.html#L144" title="core/ngx_string.h:144">ngx_memcmp</a>(n-&gt;str.data, t-&gt;str.data, n-&gt;str.len) &lt; <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; ? &amp;temp-&gt;left : &amp;temp-&gt;right;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*p == sentinel) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; temp = *p;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *p = node;<br/></li>
<li>&nbsp; &nbsp; node-&gt;parent = temp;<br/></li>
<li>&nbsp; &nbsp; node-&gt;left = sentinel;<br/></li>
<li>&nbsp; &nbsp; node-&gt;right = sentinel;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_rbtree.h.html#L59" title="core/ngx_rbtree.h:59">ngx_rbt_red</a>(node);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_string.h.html#L216" title="core/ngx_string.h:216">ngx_str_node_t</a> *<br/></li>
<li><a id="L1869">&#x200c;</a><span class="linkable">ngx_str_rbtree_lookup</span>(<a href="ngx_rbtree.h.html#L32" title="core/ngx_rbtree.h:32">ngx_rbtree_t</a> *rbtree, <a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *val, <span class="Type">uint32_t</span> hash)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; rc;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.h.html#L216" title="core/ngx_string.h:216">ngx_str_node_t</a>&nbsp; &nbsp;&nbsp; *n;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_rbtree.h.html#L20" title="core/ngx_rbtree.h:20">ngx_rbtree_node_t</a>&nbsp; *node, *sentinel;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; node = rbtree-&gt;root;<br/></li>
<li>&nbsp; &nbsp; sentinel = rbtree-&gt;sentinel;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">while</span> (node != sentinel) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = (<a href="ngx_string.h.html#L216" title="core/ngx_string.h:216">ngx_str_node_t</a> *) node;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (hash != node-&gt;key) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; node = (hash &lt; node-&gt;key) ? node-&gt;left : node-&gt;right;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (val-&gt;len != n-&gt;str.len) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; node = (val-&gt;len &lt; n-&gt;str.len) ? node-&gt;left : node-&gt;right;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; rc = <a href="ngx_string.h.html#L144" title="core/ngx_string.h:144">ngx_memcmp</a>(val-&gt;data, n-&gt;str.data, val-&gt;len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rc &lt; <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; node = node-&gt;left;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rc &gt; <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; node = node-&gt;right;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> n;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Comment">/* <a href="#L1914" title="core/ngx_string.c:1914">ngx_sort</a>() is implemented as insertion sort because we need stable sort */<br/></li>
<li></span><br/></li>
<li><span class="Type">void<br/></li>
<li><a id="L1914">&#x200c;</a></span><span class="linkable">ngx_sort</span>(<span class="Type">void</span> *base, <span class="Type">size_t</span> n, <span class="Type">size_t</span> size,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> (*cmp)(<span class="Type">const</span> <span class="Type">void</span> *, <span class="Type">const</span> <span class="Type">void</span> *))<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; *p1, *p2, *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="../os/unix/ngx_alloc.c.html#L18" title="os/unix/ngx_alloc.c:18">ngx_alloc</a>(size, <a href="ngx_cycle.c.html#L20" title="core/ngx_cycle.c:20">ngx_cycle</a>-&gt;log);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (p1 = (u_char *) base + size;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; p1 &lt; (u_char *) base + n * size;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; p1 += size)<br/></li>
<li>&nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1947" title="core/ngx_string.c:1947">ngx_memcpy</a>(p, p1, size);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (p2 = p1;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; p2 &gt; (u_char *) base &amp;&amp; cmp(p2 - size, p) &gt; <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; p2 -= size)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1947" title="core/ngx_string.c:1947">ngx_memcpy</a>(p2, p2 - size, size);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L1947" title="core/ngx_string.c:1947">ngx_memcpy</a>(p2, p, size);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../os/unix/ngx_alloc.h.html#L19" title="os/unix/ngx_alloc.h:19">ngx_free</a>(p);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_MEMCPY_LIMIT)<br/></li>
<li></span><br/></li>
<li><span class="Type">void</span> *<br/></li>
<li><a id="L1947">&#x200c;</a><span class="linkable">ngx_memcpy</span>(<span class="Type">void</span> *dst, <span class="Type">const</span> <span class="Type">void</span> *src, <span class="Type">size_t</span> n)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n &gt; NGX_MEMCPY_LIMIT) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_log.h.html#L83" title="core/ngx_log.h:83">ngx_log_error</a>(<a href="ngx_log.h.html#L18" title="core/ngx_log.h:18">NGX_LOG_ALERT</a>, <a href="ngx_cycle.c.html#L20" title="core/ngx_cycle.c:20">ngx_cycle</a>-&gt;log, <span class="Constant">0</span>, <span class="Constant">&quot;memcpy </span><span class="Special">%u</span><span class="Constant">z bytes&quot;</span>, n);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/unix/ngx_process.c.html#L594" title="os/unix/ngx_process.c:594">ngx_debug_point</a>();<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> memcpy(dst, src, n);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
</ol></span></code>
 </body>
</html>
