<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>core/ngx_inet.c - src</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>core/ngx_inet.c - src</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L1202">ngx_cmp_sockaddr</a></li>
<li><a href="#L59">ngx_inet6_addr</a></li>
<li><a href="#L286">ngx_inet6_ntop</a></li>
<li><a href="#L18">ngx_inet_addr</a></li>
<li><a href="#L256">ngx_inet_ntop</a></li>
<li><a href="#L944">ngx_inet_resolve_host</a></li>
<li><a href="#L1090">ngx_inet_resolve_host</a></li>
<li><a href="#L465">ngx_parse_addr</a></li>
<li><a href="#L817">ngx_parse_inet6_url</a></li>
<li><a href="#L622">ngx_parse_inet_url</a></li>
<li><a href="#L544">ngx_parse_unix_domain_url</a></li>
<li><a href="#L525">ngx_parse_url</a></li>
<li><a href="#L365">ngx_ptocidr</a></li>
<li><a href="#L177">ngx_sock_ntop</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Copyright (C) Igor Sysoev<br/></li>
<li></span><span class="Comment"> * Copyright (C) Nginx, Inc.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;ngx_config.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ngx_core.h&gt;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L544" title="core/ngx_inet.c:544">ngx_parse_unix_domain_url</a>(<a href="ngx_core.h.html#L15" title="core/ngx_core.h:15">ngx_pool_t</a> *pool, <a href="ngx_inet.h.html#L102" title="core/ngx_inet.h:102">ngx_url_t</a> *u);<br/></li>
<li><span class="Type">static</span> <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L622" title="core/ngx_inet.c:622">ngx_parse_inet_url</a>(<a href="ngx_core.h.html#L15" title="core/ngx_core.h:15">ngx_pool_t</a> *pool, <a href="ngx_inet.h.html#L102" title="core/ngx_inet.h:102">ngx_url_t</a> *u);<br/></li>
<li><span class="Type">static</span> <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L817" title="core/ngx_inet.c:817">ngx_parse_inet6_url</a>(<a href="ngx_core.h.html#L15" title="core/ngx_core.h:15">ngx_pool_t</a> *pool, <a href="ngx_inet.h.html#L102" title="core/ngx_inet.h:102">ngx_url_t</a> *u);<br/></li>
<li><br/></li>
<li><br/></li>
<li>in_addr_t<br/></li>
<li><a id="L18">&#x200c;</a><span class="linkable">ngx_inet_addr</span>(u_char *text, <span class="Type">size_t</span> len)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; *p, c;<br/></li>
<li>&nbsp; &nbsp; in_addr_t&nbsp; &nbsp; addr;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp;&nbsp; octet, n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; addr = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; octet = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; n = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (p = text; p &lt; text + len; p++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c = *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c &gt;= <span class="Constant">'0'</span> &amp;&amp; c &lt;= <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; octet = octet * <span class="Constant">10</span> + (c - <span class="Constant">'0'</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c == <span class="Constant">'.'</span> &amp;&amp; octet &lt; <span class="Constant">256</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; addr = (addr &lt;&lt; <span class="Constant">8</span>) + octet;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; octet = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_config.h.html#L115" title="core/ngx_config.h:115">INADDR_NONE</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">3</span> &amp;&amp; octet &lt; <span class="Constant">256</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; addr = (addr &lt;&lt; <span class="Constant">8</span>) + octet;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> htonl(addr);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_config.h.html#L115" title="core/ngx_config.h:115">INADDR_NONE</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L59">&#x200c;</a><span class="linkable">ngx_inet6_addr</span>(u_char *p, <span class="Type">size_t</span> len, u_char *addr)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; c, *zero, *digit, *s, *d;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; len4;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; n, nibbles, word;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (len == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; zero = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; digit = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; len4 = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; nibbles = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; word = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; n = <span class="Constant">8</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (p[<span class="Constant">0</span>] == <span class="Constant">':'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len--;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (<span class="Comment">/* void */</span>; len; len--) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c = *p++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c == <span class="Constant">':'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (nibbles) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; digit = p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len4 = len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *addr++ = (u_char) (word &gt;&gt; <span class="Constant">8</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *addr++ = (u_char) (word &amp; <span class="Constant">0xff</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (--n) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nibbles = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; word = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (zero == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; digit = p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len4 = len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zero = addr;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c == <span class="Constant">'.'</span> &amp;&amp; nibbles) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n &lt; <span class="Constant">2</span> || digit == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; word = <a href="#L18" title="core/ngx_inet.c:18">ngx_inet_addr</a>(digit, len4 - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (word == <a href="ngx_config.h.html#L115" title="core/ngx_config.h:115">INADDR_NONE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; word = ntohl(word);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *addr++ = (u_char) ((word &gt;&gt; <span class="Constant">24</span>) &amp; <span class="Constant">0xff</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *addr++ = (u_char) ((word &gt;&gt; <span class="Constant">16</span>) &amp; <span class="Constant">0xff</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (++nibbles &gt; <span class="Constant">4</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c &gt;= <span class="Constant">'0'</span> &amp;&amp; c &lt;= <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; word = word * <span class="Constant">16</span> + (c - <span class="Constant">'0'</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c |= <span class="Constant">0x20</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c &gt;= <span class="Constant">'a'</span> &amp;&amp; c &lt;= <span class="Constant">'f'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; word = word * <span class="Constant">16</span> + (c - <span class="Constant">'a'</span>) + <span class="Constant">10</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (nibbles == <span class="Constant">0</span> &amp;&amp; zero == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *addr++ = (u_char) (word &gt;&gt; <span class="Constant">8</span>);<br/></li>
<li>&nbsp; &nbsp; *addr++ = (u_char) (word &amp; <span class="Constant">0xff</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (--n) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (zero) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n *= <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s = addr - <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; d = s + n;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (s &gt;= zero) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *d-- = *s--;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_string.h.html#L86" title="core/ngx_string.h:86">ngx_memzero</a>(zero, n);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (zero == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">size_t<br/></li>
<li><a id="L177">&#x200c;</a></span><span class="linkable">ngx_sock_ntop</span>(<span class="Type">struct</span> sockaddr *sa, socklen_t socklen, u_char *text, <span class="Type">size_t</span> len,<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> port)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_in&nbsp;&nbsp; *sin;<br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_in6&nbsp; *sin6;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><span class="PreProc">#if (NGX_HAVE_UNIX_DOMAIN)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_un&nbsp;&nbsp; *saun;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (sa-&gt;sa_family) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> AF_INET:<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin = (<span class="Type">struct</span> sockaddr_in *) sa;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p = (u_char *) &amp;sin-&gt;sin_addr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (port) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = <a href="ngx_string.c.html#L119" title="core/ngx_string.c:119">ngx_snprintf</a>(text, len, <span class="Constant">&quot;</span><span class="Special">%u</span><span class="Constant">d.</span><span class="Special">%u</span><span class="Constant">d.</span><span class="Special">%u</span><span class="Constant">d.</span><span class="Special">%u</span><span class="Constant">d:</span><span class="Special">%d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; p[<span class="Constant">0</span>], p[<span class="Constant">1</span>], p[<span class="Constant">2</span>], p[<span class="Constant">3</span>], ntohs(sin-&gt;sin_port));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = <a href="ngx_string.c.html#L119" title="core/ngx_string.c:119">ngx_snprintf</a>(text, len, <span class="Constant">&quot;</span><span class="Special">%u</span><span class="Constant">d.</span><span class="Special">%u</span><span class="Constant">d.</span><span class="Special">%u</span><span class="Constant">d.</span><span class="Special">%u</span><span class="Constant">d&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; p[<span class="Constant">0</span>], p[<span class="Constant">1</span>], p[<span class="Constant">2</span>], p[<span class="Constant">3</span>]);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> (p - text);<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> AF_INET6:<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin6 = (<span class="Type">struct</span> sockaddr_in6 *) sa;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (port) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; text[n++] = <span class="Constant">'['</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = <a href="#L286" title="core/ngx_inet.c:286">ngx_inet6_ntop</a>(sin6-&gt;sin6_addr.s6_addr, &amp;text[n], len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (port) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n = <a href="ngx_string.c.html#L105" title="core/ngx_string.c:105">ngx_sprintf</a>(&amp;text[<span class="Constant">1</span> + n], <span class="Constant">&quot;]:</span><span class="Special">%d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ntohs(sin6-&gt;sin6_port)) - text;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> n;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_UNIX_DOMAIN)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> AF_UNIX:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; saun = (<span class="Type">struct</span> sockaddr_un *) sa;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* on Linux sockaddr might not include sun_path at all */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (socklen &lt;= (socklen_t) offsetof(<span class="Type">struct</span> sockaddr_un, sun_path)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = <a href="ngx_string.c.html#L119" title="core/ngx_string.c:119">ngx_snprintf</a>(text, len, <span class="Constant">&quot;unix:%Z&quot;</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = <a href="ngx_string.c.html#L119" title="core/ngx_string.c:119">ngx_snprintf</a>(text, len, <span class="Constant">&quot;unix:</span><span class="Special">%s</span><span class="Constant">%Z&quot;</span>, saun-&gt;sun_path);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* we do not include trailing zero in address length */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> (p - text - <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">size_t<br/></li>
<li><a id="L256">&#x200c;</a></span><span class="linkable">ngx_inet_ntop</span>(<span class="Type">int</span> family, <span class="Type">void</span> *addr, u_char *text, <span class="Type">size_t</span> len)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (family) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> AF_INET:<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p = addr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_string.c.html#L119" title="core/ngx_string.c:119">ngx_snprintf</a>(text, len, <span class="Constant">&quot;</span><span class="Special">%u</span><span class="Constant">d.</span><span class="Special">%u</span><span class="Constant">d.</span><span class="Special">%u</span><span class="Constant">d.</span><span class="Special">%u</span><span class="Constant">d&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p[<span class="Constant">0</span>], p[<span class="Constant">1</span>], p[<span class="Constant">2</span>], p[<span class="Constant">3</span>])<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; - text;<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">case</span> AF_INET6:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L286" title="core/ngx_inet.c:286">ngx_inet6_ntop</a>(addr, text, len);<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span><br/></li>
<li><span class="Type">size_t<br/></li>
<li><a id="L286">&#x200c;</a></span><span class="linkable">ngx_inet6_ntop</span>(u_char *p, u_char *text, <span class="Type">size_t</span> len)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; *dst;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp;&nbsp; max, n;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp;&nbsp; i, zero, last;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (len &lt; <a href="ngx_inet.h.html#L25" title="core/ngx_inet.h:25">NGX_INET6_ADDRSTRLEN</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; zero = (<a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>) -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; last = (<a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>) -<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; max = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; n = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; <span class="Constant">16</span>; i += <span class="Constant">2</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p[i] || p[i + <span class="Constant">1</span>]) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (max &lt; n) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zero = last;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; max = n;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n++ == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; last = i;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (max &lt; n) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; zero = last;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; max = n;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; dst = text;<br/></li>
<li>&nbsp; &nbsp; n = <span class="Constant">16</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (zero == <span class="Constant">0</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> ((max == <span class="Constant">5</span> &amp;&amp; p[<span class="Constant">10</span>] == <span class="Constant">0xff</span> &amp;&amp; p[<span class="Constant">11</span>] == <span class="Constant">0xff</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || (max == <span class="Constant">6</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; || (max == <span class="Constant">7</span> &amp;&amp; p[<span class="Constant">14</span>] != <span class="Constant">0</span> &amp;&amp; p[<span class="Constant">15</span>] != <span class="Constant">1</span>))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n = <span class="Constant">12</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <span class="Constant">':'</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; n; i += <span class="Constant">2</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (i == zero) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <span class="Constant">':'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i += (max - <span class="Constant">1</span>) * <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dst = <a href="ngx_string.c.html#L105" title="core/ngx_string.c:105">ngx_sprintf</a>(dst, <span class="Constant">&quot;</span><span class="Special">%u</span><span class="Constant">xi&quot;</span>, p[i] * <span class="Constant">256</span> + p[i + <span class="Constant">1</span>]);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (i &lt; <span class="Constant">14</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *dst++ = <span class="Constant">':'</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (n == <span class="Constant">12</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; dst = <a href="ngx_string.c.html#L105" title="core/ngx_string.c:105">ngx_sprintf</a>(dst, <span class="Constant">&quot;</span><span class="Special">%u</span><span class="Constant">d.</span><span class="Special">%u</span><span class="Constant">d.</span><span class="Special">%u</span><span class="Constant">d.</span><span class="Special">%u</span><span class="Constant">d&quot;</span>, p[<span class="Constant">12</span>], p[<span class="Constant">13</span>], p[<span class="Constant">14</span>], p[<span class="Constant">15</span>]);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> dst - text;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L365">&#x200c;</a><span class="linkable">ngx_ptocidr</span>(<a href="ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a> *text, <a href="ngx_inet.h.html#L67" title="core/ngx_inet.h:67">ngx_cidr_t</a> *cidr)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; *addr, *mask, *last;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp;&nbsp; len;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; shift;<br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span>&nbsp; &nbsp; <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; rc;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp;&nbsp; s, i;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; addr = text-&gt;data;<br/></li>
<li>&nbsp; &nbsp; last = addr + text-&gt;len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; mask = <a href="ngx_string.h.html#L66" title="core/ngx_string.h:66">ngx_strlchr</a>(addr, last, <span class="Constant">'/'</span>);<br/></li>
<li>&nbsp; &nbsp; len = (mask ? mask : last) - addr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cidr-&gt;u.in.addr = <a href="#L18" title="core/ngx_inet.c:18">ngx_inet_addr</a>(addr, len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cidr-&gt;u.in.addr != <a href="ngx_config.h.html#L115" title="core/ngx_config.h:115">INADDR_NONE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cidr-&gt;family = AF_INET;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (mask == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cidr-&gt;u.in.mask = <span class="Constant">0xffffffff</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span>&nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L59" title="core/ngx_inet.c:59">ngx_inet6_addr</a>(addr, len, cidr-&gt;u.in6.addr.s6_addr) == <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cidr-&gt;family = AF_INET6;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (mask == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_string.h.html#L87" title="core/ngx_string.h:87">ngx_memset</a>(cidr-&gt;u.in6.mask.s6_addr, <span class="Constant">0xff</span>, <span class="Constant">16</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; mask++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; shift = <a href="ngx_string.c.html#L898" title="core/ngx_string.c:898">ngx_atoi</a>(mask, last - mask);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (shift == <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (cidr-&gt;family) {<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">case</span> AF_INET6:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (shift &gt; <span class="Constant">128</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; addr = cidr-&gt;u.in6.addr.s6_addr;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; mask = cidr-&gt;u.in6.mask.s6_addr;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; rc = <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; <span class="Constant">16</span>; i++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s = (shift &gt; <span class="Constant">8</span>) ? <span class="Constant">8</span> : shift;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; shift -= s;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; mask[i] = (u_char) (<span class="Constant">0xffu</span> &lt;&lt; (<span class="Constant">8</span> - s));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (addr[i] != (addr[i] &amp; mask[i])) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rc = <a href="ngx_core.h.html#L33" title="core/ngx_core.h:33">NGX_DONE</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; addr[i] &amp;= mask[i];<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> rc;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:</span> <span class="Comment">/* AF_INET */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (shift &gt; <span class="Constant">32</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (shift) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cidr-&gt;u.in.mask = htonl((<span class="Type">uint32_t</span>) (<span class="Constant">0xffffffffu</span> &lt;&lt; (<span class="Constant">32</span> - shift)));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* x86 compilers use a shl instruction that shifts by modulo 32 */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cidr-&gt;u.in.mask = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cidr-&gt;u.in.addr == (cidr-&gt;u.in.addr &amp; cidr-&gt;u.in.mask)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; cidr-&gt;u.in.addr &amp;= cidr-&gt;u.in.mask;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L33" title="core/ngx_core.h:33">NGX_DONE</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L465">&#x200c;</a><span class="linkable">ngx_parse_addr</span>(<a href="ngx_core.h.html#L15" title="core/ngx_core.h:15">ngx_pool_t</a> *pool, <a href="ngx_inet.h.html#L74" title="core/ngx_inet.h:74">ngx_addr_t</a> *addr, u_char *text, <span class="Type">size_t</span> len)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; in_addr_t&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; inaddr;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; family;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_in&nbsp;&nbsp; *sin;<br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">struct</span> in6_addr&nbsp; &nbsp; &nbsp;&nbsp; inaddr6;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_in6&nbsp; *sin6;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * prevent MSVC8 warning:<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; potentially uninitialized local variable 'inaddr6' used<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span>&nbsp; &nbsp; <a href="ngx_string.h.html#L86" title="core/ngx_string.h:86">ngx_memzero</a>(&amp;inaddr6, <span class="Statement">sizeof</span>(<span class="Type">struct</span> in6_addr));<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; inaddr = <a href="#L18" title="core/ngx_inet.c:18">ngx_inet_addr</a>(text, len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (inaddr != <a href="ngx_config.h.html#L115" title="core/ngx_config.h:115">INADDR_NONE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; family = AF_INET;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Statement">sizeof</span>(<span class="Type">struct</span> sockaddr_in);<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span>&nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (<a href="#L59" title="core/ngx_inet.c:59">ngx_inet6_addr</a>(text, len, inaddr6.s6_addr) == <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; family = AF_INET6;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = <span class="Statement">sizeof</span>(<span class="Type">struct</span> sockaddr_in6);<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L34" title="core/ngx_core.h:34">NGX_DECLINED</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; addr-&gt;sockaddr = <a href="ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(pool, len);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (addr-&gt;sockaddr == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; addr-&gt;sockaddr-&gt;sa_family = (u_char) family;<br/></li>
<li>&nbsp; &nbsp; addr-&gt;socklen = len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (family) {<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">case</span> AF_INET6:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin6 = (<span class="Type">struct</span> sockaddr_in6 *) addr-&gt;sockaddr;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_string.c.html#L1947" title="core/ngx_string.c:1947">ngx_memcpy</a>(sin6-&gt;sin6_addr.s6_addr, inaddr6.s6_addr, <span class="Constant">16</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:</span> <span class="Comment">/* AF_INET */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; sin = (<span class="Type">struct</span> sockaddr_in *) addr-&gt;sockaddr;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin-&gt;sin_addr.s_addr = inaddr;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L525">&#x200c;</a><span class="linkable">ngx_parse_url</span>(<a href="ngx_core.h.html#L15" title="core/ngx_core.h:15">ngx_pool_t</a> *pool, <a href="ngx_inet.h.html#L102" title="core/ngx_inet.h:102">ngx_url_t</a> *u)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; *p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = u-&gt;url.data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_string.c.html#L593" title="core/ngx_string.c:593">ngx_strncasecmp</a>(p, (u_char *) <span class="Constant">&quot;unix:&quot;</span>, <span class="Constant">5</span>) == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L544" title="core/ngx_inet.c:544">ngx_parse_unix_domain_url</a>(pool, u);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (p[<span class="Constant">0</span>] == <span class="Constant">'['</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L817" title="core/ngx_inet.c:817">ngx_parse_inet6_url</a>(pool, u);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L622" title="core/ngx_inet.c:622">ngx_parse_inet_url</a>(pool, u);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L544">&#x200c;</a><span class="linkable">ngx_parse_unix_domain_url</span>(<a href="ngx_core.h.html#L15" title="core/ngx_core.h:15">ngx_pool_t</a> *pool, <a href="ngx_inet.h.html#L102" title="core/ngx_inet.h:102">ngx_url_t</a> *u)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#if (NGX_HAVE_UNIX_DOMAIN)<br/></li>
<li></span>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *path, *uri, *last;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; len;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_un&nbsp; *saun;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; len = u-&gt;url.len;<br/></li>
<li>&nbsp; &nbsp; path = u-&gt;url.data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; path += <span class="Constant">5</span>;<br/></li>
<li>&nbsp; &nbsp; len -= <span class="Constant">5</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (u-&gt;uri_part) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; last = path + len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; uri = <a href="ngx_string.h.html#L66" title="core/ngx_string.h:66">ngx_strlchr</a>(path, last, <span class="Constant">':'</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (uri) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = uri - path;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; uri++;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;uri.len = last - uri;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;uri.data = uri;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (len == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;err = <span class="Constant">&quot;no path in the unix domain socket&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; u-&gt;host.len = len++;<br/></li>
<li>&nbsp; &nbsp; u-&gt;host.data = path;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (len &gt; <span class="Statement">sizeof</span>(saun-&gt;sun_path)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;err = <span class="Constant">&quot;too long path in the unix domain socket&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; u-&gt;socklen = <span class="Statement">sizeof</span>(<span class="Type">struct</span> sockaddr_un);<br/></li>
<li>&nbsp; &nbsp; saun = (<span class="Type">struct</span> sockaddr_un *) &amp;u-&gt;sockaddr;<br/></li>
<li>&nbsp; &nbsp; saun-&gt;sun_family = AF_UNIX;<br/></li>
<li>&nbsp; &nbsp; (<span class="Type">void</span>) <a href="ngx_string.c.html#L33" title="core/ngx_string.c:33">ngx_cpystrn</a>((u_char *) saun-&gt;sun_path, path, len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; u-&gt;addrs = <a href="ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(pool, <span class="Statement">sizeof</span>(<a href="ngx_inet.h.html#L74" title="core/ngx_inet.h:74">ngx_addr_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (u-&gt;addrs == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; saun = <a href="ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(pool, <span class="Statement">sizeof</span>(<span class="Type">struct</span> sockaddr_un));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (saun == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; u-&gt;family = AF_UNIX;<br/></li>
<li>&nbsp; &nbsp; u-&gt;naddrs = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; saun-&gt;sun_family = AF_UNIX;<br/></li>
<li>&nbsp; &nbsp; (<span class="Type">void</span>) <a href="ngx_string.c.html#L33" title="core/ngx_string.c:33">ngx_cpystrn</a>((u_char *) saun-&gt;sun_path, path, len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; u-&gt;addrs[<span class="Constant">0</span>].sockaddr = (<span class="Type">struct</span> sockaddr *) saun;<br/></li>
<li>&nbsp; &nbsp; u-&gt;addrs[<span class="Constant">0</span>].socklen = <span class="Statement">sizeof</span>(<span class="Type">struct</span> sockaddr_un);<br/></li>
<li>&nbsp; &nbsp; u-&gt;addrs[<span class="Constant">0</span>].name.len = len + <span class="Constant">4</span>;<br/></li>
<li>&nbsp; &nbsp; u-&gt;addrs[<span class="Constant">0</span>].name.data = u-&gt;url.data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; u-&gt;err = <span class="Constant">&quot;the unix domain sockets are not supported on this platform&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L622">&#x200c;</a><span class="linkable">ngx_parse_inet_url</span>(<a href="ngx_core.h.html#L15" title="core/ngx_core.h:15">ngx_pool_t</a> *pool, <a href="ngx_inet.h.html#L102" title="core/ngx_inet.h:102">ngx_url_t</a> *u)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p, *host, *port, *last, *uri, *args;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; n;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_in&nbsp;&nbsp; *sin;<br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_in6&nbsp; *sin6;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; u-&gt;socklen = <span class="Statement">sizeof</span>(<span class="Type">struct</span> sockaddr_in);<br/></li>
<li>&nbsp; &nbsp; sin = (<span class="Type">struct</span> sockaddr_in *) &amp;u-&gt;sockaddr;<br/></li>
<li>&nbsp; &nbsp; sin-&gt;sin_family = AF_INET;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; u-&gt;family = AF_INET;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; host = u-&gt;url.data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; last = host + u-&gt;url.len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; port = <a href="ngx_string.h.html#L66" title="core/ngx_string.h:66">ngx_strlchr</a>(host, last, <span class="Constant">':'</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; uri = <a href="ngx_string.h.html#L66" title="core/ngx_string.h:66">ngx_strlchr</a>(host, last, <span class="Constant">'/'</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; args = <a href="ngx_string.h.html#L66" title="core/ngx_string.h:66">ngx_strlchr</a>(host, last, <span class="Constant">'?'</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (args) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (uri == <span class="Constant">NULL</span> || args &lt; uri) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; uri = args;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (uri) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (u-&gt;listen || !u-&gt;uri_part) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;err = <span class="Constant">&quot;invalid host&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;uri.len = last - uri;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;uri.data = uri;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; last = uri;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (uri &lt; port) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port = <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (port) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; port++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = last - port;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; n = <a href="ngx_string.c.html#L898" title="core/ngx_string.c:898">ngx_atoi</a>(port, len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n &lt; <span class="Constant">1</span> || n &gt; <span class="Constant">65535</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;err = <span class="Constant">&quot;invalid port&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;port = (in_port_t) n;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin-&gt;sin_port = htons((in_port_t) n);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;port_text.len = len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;port_text.data = port;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; last = port - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (uri == <span class="Constant">NULL</span>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (u-&gt;listen) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* test value as port only */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n = <a href="ngx_string.c.html#L898" title="core/ngx_string.c:898">ngx_atoi</a>(host, last - host);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n != <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n &lt; <span class="Constant">1</span> || n &gt; <span class="Constant">65535</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;err = <span class="Constant">&quot;invalid port&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;port = (in_port_t) n;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sin-&gt;sin_port = htons((in_port_t) n);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;port_text.len = last - host;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;port_text.data = host;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;wildcard = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;no_port = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;port = u-&gt;default_port;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin-&gt;sin_port = htons(u-&gt;default_port);<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; len = last - host;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (len == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;err = <span class="Constant">&quot;no host&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; u-&gt;host.len = len;<br/></li>
<li>&nbsp; &nbsp; u-&gt;host.data = host;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (u-&gt;listen &amp;&amp; len == <span class="Constant">1</span> &amp;&amp; *host == <span class="Constant">'*'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin-&gt;sin_addr.s_addr = INADDR_ANY;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;wildcard = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sin-&gt;sin_addr.s_addr = <a href="#L18" title="core/ngx_inet.c:18">ngx_inet_addr</a>(host, len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sin-&gt;sin_addr.s_addr != <a href="ngx_config.h.html#L115" title="core/ngx_config.h:115">INADDR_NONE</a>) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sin-&gt;sin_addr.s_addr == INADDR_ANY) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;wildcard = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;naddrs = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs = <a href="ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(pool, <span class="Statement">sizeof</span>(<a href="ngx_inet.h.html#L74" title="core/ngx_inet.h:74">ngx_addr_t</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (u-&gt;addrs == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin = <a href="ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(pool, <span class="Statement">sizeof</span>(<span class="Type">struct</span> sockaddr_in));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sin == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_string.c.html#L1947" title="core/ngx_string.c:1947">ngx_memcpy</a>(sin, u-&gt;sockaddr, <span class="Statement">sizeof</span>(<span class="Type">struct</span> sockaddr_in));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[<span class="Constant">0</span>].sockaddr = (<span class="Type">struct</span> sockaddr *) sin;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[<span class="Constant">0</span>].socklen = <span class="Statement">sizeof</span>(<span class="Type">struct</span> sockaddr_in);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p = <a href="ngx_palloc.c.html#L150" title="core/ngx_palloc.c:150">ngx_pnalloc</a>(pool, u-&gt;host.len + <span class="Statement">sizeof</span>(<span class="Constant">&quot;:65535&quot;</span>) - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[<span class="Constant">0</span>].name.len = <a href="ngx_string.c.html#L105" title="core/ngx_string.c:105">ngx_sprintf</a>(p, <span class="Constant">&quot;%V:</span><span class="Special">%d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;u-&gt;host, u-&gt;port) - p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[<span class="Constant">0</span>].name.data = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (u-&gt;no_resolve) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L944" title="core/ngx_inet.c:944">ngx_inet_resolve_host</a>(pool, u) != <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; u-&gt;family = u-&gt;addrs[<span class="Constant">0</span>].sockaddr-&gt;sa_family;<br/></li>
<li>&nbsp; &nbsp; u-&gt;socklen = u-&gt;addrs[<span class="Constant">0</span>].socklen;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.c.html#L1947" title="core/ngx_string.c:1947">ngx_memcpy</a>(u-&gt;sockaddr, u-&gt;addrs[<span class="Constant">0</span>].sockaddr, u-&gt;addrs[<span class="Constant">0</span>].socklen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (u-&gt;family) {<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">case</span> AF_INET6:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin6 = (<span class="Type">struct</span> sockaddr_in6 *) &amp;u-&gt;sockaddr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (IN6_IS_ADDR_UNSPECIFIED(&amp;sin6-&gt;sin6_addr)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;wildcard = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:</span> <span class="Comment">/* AF_INET */<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; sin = (<span class="Type">struct</span> sockaddr_in *) &amp;u-&gt;sockaddr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sin-&gt;sin_addr.s_addr == INADDR_ANY) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;wildcard = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L817">&#x200c;</a><span class="linkable">ngx_parse_inet6_url</span>(<a href="ngx_core.h.html#L15" title="core/ngx_core.h:15">ngx_pool_t</a> *pool, <a href="ngx_inet.h.html#L102" title="core/ngx_inet.h:102">ngx_url_t</a> *u)<br/></li>
<li>{<br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p, *host, *port, *last, *uri;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; n;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_in6&nbsp; *sin6;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; u-&gt;socklen = <span class="Statement">sizeof</span>(<span class="Type">struct</span> sockaddr_in6);<br/></li>
<li>&nbsp; &nbsp; sin6 = (<span class="Type">struct</span> sockaddr_in6 *) &amp;u-&gt;sockaddr;<br/></li>
<li>&nbsp; &nbsp; sin6-&gt;sin6_family = AF_INET6;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; host = u-&gt;url.data + <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; last = u-&gt;url.data + u-&gt;url.len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_string.h.html#L66" title="core/ngx_string.h:66">ngx_strlchr</a>(host, last, <span class="Constant">']'</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;err = <span class="Constant">&quot;invalid host&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (last - p) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; port = p + <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; uri = <a href="ngx_string.h.html#L66" title="core/ngx_string.h:66">ngx_strlchr</a>(port, last, <span class="Constant">'/'</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (uri) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (u-&gt;listen || !u-&gt;uri_part) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;err = <span class="Constant">&quot;invalid host&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;uri.len = last - uri;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;uri.data = uri;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; last = uri;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (*port == <span class="Constant">':'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = last - port;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n = <a href="ngx_string.c.html#L898" title="core/ngx_string.c:898">ngx_atoi</a>(port, len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (n &lt; <span class="Constant">1</span> || n &gt; <span class="Constant">65535</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;err = <span class="Constant">&quot;invalid port&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;port = (in_port_t) n;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sin6-&gt;sin6_port = htons((in_port_t) n);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;port_text.len = len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;port_text.data = port;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;no_port = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;port = u-&gt;default_port;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sin6-&gt;sin6_port = htons(u-&gt;default_port);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; len = p - host;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (len == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;err = <span class="Constant">&quot;no host&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; u-&gt;host.len = len + <span class="Constant">2</span>;<br/></li>
<li>&nbsp; &nbsp; u-&gt;host.data = host - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (<a href="#L59" title="core/ngx_inet.c:59">ngx_inet6_addr</a>(host, len, sin6-&gt;sin6_addr.s6_addr) != <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;err = <span class="Constant">&quot;invalid IPv6 address&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (IN6_IS_ADDR_UNSPECIFIED(&amp;sin6-&gt;sin6_addr)) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;wildcard = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; u-&gt;family = AF_INET6;<br/></li>
<li>&nbsp; &nbsp; u-&gt;naddrs = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; u-&gt;addrs = <a href="ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(pool, <span class="Statement">sizeof</span>(<a href="ngx_inet.h.html#L74" title="core/ngx_inet.h:74">ngx_addr_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (u-&gt;addrs == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; sin6 = <a href="ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(pool, <span class="Statement">sizeof</span>(<span class="Type">struct</span> sockaddr_in6));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sin6 == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.c.html#L1947" title="core/ngx_string.c:1947">ngx_memcpy</a>(sin6, u-&gt;sockaddr, <span class="Statement">sizeof</span>(<span class="Type">struct</span> sockaddr_in6));<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; u-&gt;addrs[<span class="Constant">0</span>].sockaddr = (<span class="Type">struct</span> sockaddr *) sin6;<br/></li>
<li>&nbsp; &nbsp; u-&gt;addrs[<span class="Constant">0</span>].socklen = <span class="Statement">sizeof</span>(<span class="Type">struct</span> sockaddr_in6);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; p = <a href="ngx_palloc.c.html#L150" title="core/ngx_palloc.c:150">ngx_pnalloc</a>(pool, u-&gt;host.len + <span class="Statement">sizeof</span>(<span class="Constant">&quot;:65535&quot;</span>) - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; u-&gt;addrs[<span class="Constant">0</span>].name.len = <a href="ngx_string.c.html#L105" title="core/ngx_string.c:105">ngx_sprintf</a>(p, <span class="Constant">&quot;%V:</span><span class="Special">%d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;u-&gt;host, u-&gt;port) - p;<br/></li>
<li>&nbsp; &nbsp; u-&gt;addrs[<span class="Constant">0</span>].name.data = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#else<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; u-&gt;err = <span class="Constant">&quot;the INET6 sockets are not supported on this platform&quot;</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_GETADDRINFO &amp;&amp; NGX_HAVE_INET6)<br/></li>
<li></span><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L944">&#x200c;</a><span class="linkable">ngx_inet_resolve_host</span>(<a href="ngx_core.h.html#L15" title="core/ngx_core.h:15">ngx_pool_t</a> *pool, <a href="ngx_inet.h.html#L102" title="core/ngx_inet.h:102">ngx_url_t</a> *u)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *p, *host;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len;<br/></li>
<li>&nbsp; &nbsp; in_port_t&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; port;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> addrinfo&nbsp; &nbsp; &nbsp;&nbsp; hints, *res, *rp;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_in&nbsp;&nbsp; *sin;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_in6&nbsp; *sin6;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; port = htons(u-&gt;port);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; host = <a href="../os/unix/ngx_alloc.c.html#L18" title="os/unix/ngx_alloc.c:18">ngx_alloc</a>(u-&gt;host.len + <span class="Constant">1</span>, pool-&gt;log);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (host == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; (<span class="Type">void</span>) <a href="ngx_string.c.html#L33" title="core/ngx_string.c:33">ngx_cpystrn</a>(host, u-&gt;host.data, u-&gt;host.len + <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="ngx_string.h.html#L86" title="core/ngx_string.h:86">ngx_memzero</a>(&amp;hints, <span class="Statement">sizeof</span>(<span class="Type">struct</span> addrinfo));<br/></li>
<li>&nbsp; &nbsp; hints.ai_family = AF_UNSPEC;<br/></li>
<li>&nbsp; &nbsp; hints.ai_socktype = SOCK_STREAM;<br/></li>
<li><span class="PreProc">#ifdef AI_ADDRCONFIG<br/></li>
<li></span>&nbsp; &nbsp; hints.ai_flags = AI_ADDRCONFIG;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (getaddrinfo((<span class="Type">char</span> *) host, <span class="Constant">NULL</span>, &amp;hints, &amp;res) != <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;err = <span class="Constant">&quot;host not found&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/unix/ngx_alloc.h.html#L19" title="os/unix/ngx_alloc.h:19">ngx_free</a>(host);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../os/unix/ngx_alloc.h.html#L19" title="os/unix/ngx_alloc.h:19">ngx_free</a>(host);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>, rp = res; rp != <span class="Constant">NULL</span>; rp = rp-&gt;ai_next) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">switch</span> (rp-&gt;ai_family) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> AF_INET:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">case</span> AF_INET6:<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; i++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (i == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;err = <span class="Constant">&quot;host not found&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> failed;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* MP: ngx_shared_palloc() */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; u-&gt;addrs = <a href="ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(pool, i * <span class="Statement">sizeof</span>(<a href="ngx_inet.h.html#L74" title="core/ngx_inet.h:74">ngx_addr_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (u-&gt;addrs == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> failed;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; u-&gt;naddrs = i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; i = <span class="Constant">0</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* AF_INET addresses first */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (rp = res; rp != <span class="Constant">NULL</span>; rp = rp-&gt;ai_next) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rp-&gt;ai_family != AF_INET) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin = <a href="ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(pool, rp-&gt;ai_addrlen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sin == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> failed;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_string.c.html#L1947" title="core/ngx_string.c:1947">ngx_memcpy</a>(sin, rp-&gt;ai_addr, rp-&gt;ai_addrlen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin-&gt;sin_port = port;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[i].sockaddr = (<span class="Type">struct</span> sockaddr *) sin;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[i].socklen = rp-&gt;ai_addrlen;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = <a href="ngx_inet.h.html#L24" title="core/ngx_inet.h:24">NGX_INET_ADDRSTRLEN</a> + <span class="Statement">sizeof</span>(<span class="Constant">&quot;:65535&quot;</span>) - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p = <a href="ngx_palloc.c.html#L150" title="core/ngx_palloc.c:150">ngx_pnalloc</a>(pool, len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> failed;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = <a href="#L177" title="core/ngx_inet.c:177">ngx_sock_ntop</a>((<span class="Type">struct</span> sockaddr *) sin, rp-&gt;ai_addrlen, p, len, <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[i].name.len = len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[i].name.data = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; i++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (rp = res; rp != <span class="Constant">NULL</span>; rp = rp-&gt;ai_next) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (rp-&gt;ai_family != AF_INET6) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin6 = <a href="ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(pool, rp-&gt;ai_addrlen);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sin6 == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> failed;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="ngx_string.c.html#L1947" title="core/ngx_string.c:1947">ngx_memcpy</a>(sin6, rp-&gt;ai_addr, rp-&gt;ai_addrlen);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin6-&gt;sin6_port = port;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[i].sockaddr = (<span class="Type">struct</span> sockaddr *) sin6;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[i].socklen = rp-&gt;ai_addrlen;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = <a href="ngx_inet.h.html#L25" title="core/ngx_inet.h:25">NGX_INET6_ADDRSTRLEN</a> + <span class="Statement">sizeof</span>(<span class="Constant">&quot;[]:65535&quot;</span>) - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p = <a href="ngx_palloc.c.html#L150" title="core/ngx_palloc.c:150">ngx_pnalloc</a>(pool, len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> failed;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; len = <a href="#L177" title="core/ngx_inet.c:177">ngx_sock_ntop</a>((<span class="Type">struct</span> sockaddr *) sin6, rp-&gt;ai_addrlen, p,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len, <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[i].name.len = len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[i].name.data = p;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; i++;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; freeaddrinfo(res);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li><br/></li>
<li><span class="Statement">failed</span><span class="cUserCont">:<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; freeaddrinfo(res);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="PreProc">#else</span> <span class="Comment">/* !NGX_HAVE_GETADDRINFO || !NGX_HAVE_INET6 */<br/></li>
<li></span><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L1090">&#x200c;</a><span class="linkable">ngx_inet_resolve_host</span>(<a href="ngx_core.h.html#L15" title="core/ngx_core.h:15">ngx_pool_t</a> *pool, <a href="ngx_inet.h.html#L102" title="core/ngx_inet.h:102">ngx_url_t</a> *u)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *p, *host;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; len;<br/></li>
<li>&nbsp; &nbsp; in_port_t&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port;<br/></li>
<li>&nbsp; &nbsp; in_addr_t&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; in_addr;<br/></li>
<li>&nbsp; &nbsp; <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; i;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> hostent&nbsp; &nbsp; &nbsp; *h;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_in&nbsp; *sin;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* AF_INET only */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; port = htons(u-&gt;port);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; in_addr = <a href="#L18" title="core/ngx_inet.c:18">ngx_inet_addr</a>(u-&gt;host.data, u-&gt;host.len);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (in_addr == <a href="ngx_config.h.html#L115" title="core/ngx_config.h:115">INADDR_NONE</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; host = <a href="../os/unix/ngx_alloc.c.html#L18" title="os/unix/ngx_alloc.c:18">ngx_alloc</a>(u-&gt;host.len + <span class="Constant">1</span>, pool-&gt;log);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (host == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; (<span class="Type">void</span>) <a href="ngx_string.c.html#L33" title="core/ngx_string.c:33">ngx_cpystrn</a>(host, u-&gt;host.data, u-&gt;host.len + <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; h = gethostbyname((<span class="Type">char</span> *) host);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../os/unix/ngx_alloc.h.html#L19" title="os/unix/ngx_alloc.h:19">ngx_free</a>(host);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (h == <span class="Constant">NULL</span> || h-&gt;h_addr_list[<span class="Constant">0</span>] == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;err = <span class="Constant">&quot;host not found&quot;</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; h-&gt;h_addr_list[i] != <span class="Constant">NULL</span>; i++) { <span class="Comment">/* void */</span> }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* MP: ngx_shared_palloc() */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs = <a href="ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(pool, i * <span class="Statement">sizeof</span>(<a href="ngx_inet.h.html#L74" title="core/ngx_inet.h:74">ngx_addr_t</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (u-&gt;addrs == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;naddrs = i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; u-&gt;naddrs; i++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sin = <a href="ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(pool, <span class="Statement">sizeof</span>(<span class="Type">struct</span> sockaddr_in));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sin == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sin-&gt;sin_family = AF_INET;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sin-&gt;sin_port = port;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sin-&gt;sin_addr.s_addr = *(in_addr_t *) (h-&gt;h_addr_list[i]);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[i].sockaddr = (<span class="Type">struct</span> sockaddr *) sin;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[i].socklen = <span class="Statement">sizeof</span>(<span class="Type">struct</span> sockaddr_in);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = <a href="ngx_inet.h.html#L24" title="core/ngx_inet.h:24">NGX_INET_ADDRSTRLEN</a> + <span class="Statement">sizeof</span>(<span class="Constant">&quot;:65535&quot;</span>) - <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p = <a href="ngx_palloc.c.html#L150" title="core/ngx_palloc.c:150">ngx_pnalloc</a>(pool, len);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len = <a href="#L177" title="core/ngx_inet.c:177">ngx_sock_ntop</a>((<span class="Type">struct</span> sockaddr *) sin,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<span class="Type">struct</span> sockaddr_in), p, len, <span class="Constant">1</span>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[i].name.len = len;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[i].name.data = p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* MP: ngx_shared_palloc() */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs = <a href="ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(pool, <span class="Statement">sizeof</span>(<a href="ngx_inet.h.html#L74" title="core/ngx_inet.h:74">ngx_addr_t</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (u-&gt;addrs == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin = <a href="ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(pool, <span class="Statement">sizeof</span>(<span class="Type">struct</span> sockaddr_in));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sin == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;naddrs = <span class="Constant">1</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin-&gt;sin_family = AF_INET;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin-&gt;sin_port = port;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin-&gt;sin_addr.s_addr = in_addr;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[<span class="Constant">0</span>].sockaddr = (<span class="Type">struct</span> sockaddr *) sin;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[<span class="Constant">0</span>].socklen = <span class="Statement">sizeof</span>(<span class="Type">struct</span> sockaddr_in);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; p = <a href="ngx_palloc.c.html#L150" title="core/ngx_palloc.c:150">ngx_pnalloc</a>(pool, u-&gt;host.len + <span class="Statement">sizeof</span>(<span class="Constant">&quot;:65535&quot;</span>) - <span class="Constant">1</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (p == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[<span class="Constant">0</span>].name.len = <a href="ngx_string.c.html#L105" title="core/ngx_string.c:105">ngx_sprintf</a>(p, <span class="Constant">&quot;%V:</span><span class="Special">%d</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &amp;u-&gt;host, ntohs(port)) - p;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; u-&gt;addrs[<span class="Constant">0</span>].name.data = p;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><span class="PreProc">#endif</span> <span class="Comment">/* NGX_HAVE_GETADDRINFO &amp;&amp; NGX_HAVE_INET6 */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a href="ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L1202">&#x200c;</a><span class="linkable">ngx_cmp_sockaddr</span>(<span class="Type">struct</span> sockaddr *sa1, socklen_t slen1,<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr *sa2, socklen_t slen2, <a href="ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> cmp_port)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_in&nbsp;&nbsp; *sin1, *sin2;<br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_in6&nbsp; *sin61, *sin62;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><span class="PreProc">#if (NGX_HAVE_UNIX_DOMAIN)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Type">struct</span> sockaddr_un&nbsp;&nbsp; *saun1, *saun2;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (sa1-&gt;sa_family != sa2-&gt;sa_family) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L34" title="core/ngx_core.h:34">NGX_DECLINED</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">switch</span> (sa1-&gt;sa_family) {<br/></li>
<li><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_INET6)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">case</span> AF_INET6:<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin61 = (<span class="Type">struct</span> sockaddr_in6 *) sa1;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin62 = (<span class="Type">struct</span> sockaddr_in6 *) sa2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cmp_port &amp;&amp; sin61-&gt;sin6_port != sin62-&gt;sin6_port) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L34" title="core/ngx_core.h:34">NGX_DECLINED</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="ngx_string.h.html#L144" title="core/ngx_string.h:144">ngx_memcmp</a>(&amp;sin61-&gt;sin6_addr, &amp;sin62-&gt;sin6_addr, <span class="Constant">16</span>) != <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L34" title="core/ngx_core.h:34">NGX_DECLINED</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="PreProc">#if (NGX_HAVE_UNIX_DOMAIN)<br/></li>
<li></span>&nbsp; &nbsp; <span class="Statement">case</span> AF_UNIX:<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* </span><span class="Todo">TODO</span><span class="Comment"> length */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; saun1 = (<span class="Type">struct</span> sockaddr_un *) sa1;<br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; saun2 = (<span class="Type">struct</span> sockaddr_un *) sa2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">if</span> (<a href="ngx_string.h.html#L144" title="core/ngx_string.h:144">ngx_memcmp</a>(&amp;saun1-&gt;sun_path, &amp;saun2-&gt;sun_path,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(saun1-&gt;sun_path))<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; != <span class="Constant">0</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L34" title="core/ngx_core.h:34">NGX_DECLINED</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">break</span>;<br/></li>
<li><span class="PreProc">#endif<br/></li>
<li></span><br/></li>
<li><span class="cUserCont">&nbsp; &nbsp; </span><span class="Statement">default</span><span class="cUserCont">:</span> <span class="Comment">/* AF_INET */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin1 = (<span class="Type">struct</span> sockaddr_in *) sa1;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; sin2 = (<span class="Type">struct</span> sockaddr_in *) sa2;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cmp_port &amp;&amp; sin1-&gt;sin_port != sin2-&gt;sin_port) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L34" title="core/ngx_core.h:34">NGX_DECLINED</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (sin1-&gt;sin_addr.s_addr != sin2-&gt;sin_addr.s_addr) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L34" title="core/ngx_core.h:34">NGX_DECLINED</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
</ol></code>
 </body>
</html>
