<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>http/modules/ngx_http_browser_module.c - src</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
}

span.Constant {
    color: DarkGreen;
}

span.Special {
    color: #c06000;
}

span.Comment {
    color: DarkRed;
    font-style: italic;
}

span.Identifier {
    color: DarkCyan;
}

span.PreProc {
    color: DarkMagenta;
}

span.Statement, span.Type, span.Keyword, span.Repeat, span.Conditional,
    span.Operator, span.Exception
{
    color: DarkBlue;
}

span.Todo {
    color: DarkRed;
    background-color: Gold;
    font-style: italic;
}

span.Underlined {
    text-decoration: underline;
}

span.linkable {
    font-weight: bold;
}

code ol {
    counter-reset: item;
    list-style-type: none;
    margin-left: 0;
    padding-left: 0;
    list-style-position: inside;
}

code li {
    display: block;
}

code li:before {
    content: counter(item) "  ";
    counter-increment: item;
    color: #999;
    padding-right: 0.5em;
    padding-left: 0.4em;
    list-style-position: inside;
    text-align: right
}

  </style>
 </head>
 <body>
  <h3>http/modules/ngx_http_browser_module.c - src</h3>
   <a href="../index.html"> Table of Contents </a>
 <h4>Global variables defined</h4>
 <ul>
<li><a href="#L82">ngx_http_browser_commands</a></li>
<li><a href="#L131">ngx_http_browser_module</a></li>
<li><a href="#L116">ngx_http_browser_module_ctx</a></li>
<li><a href="#L221">ngx_http_browsers</a></li>
<li><a href="#L147">ngx_http_modern_browser_masks</a></li>
</ul>
 <h4>Data types defined</h4>
 <ul>
<li><a href="#L55">ngx_http_browser_conf_t</a></li>
<li><a href="#L44">ngx_http_browser_variable_t</a></li>
<li><a href="#L29">ngx_http_modern_browser_mask_t</a></li>
<li><a href="#L37">ngx_http_modern_browser_t</a></li>
</ul>
 <h4>Functions defined</h4>
 <ul>
<li><a href="#L633">ngx_http_ancient_browser</a></li>
<li><a href="#L694">ngx_http_ancient_browser_value</a></li>
<li><a href="#L258">ngx_http_browser</a></li>
<li><a href="#L400">ngx_http_browser_add_variable</a></li>
<li><a href="#L421">ngx_http_browser_create_conf</a></li>
<li><a href="#L447">ngx_http_browser_merge_conf</a></li>
<li><a href="#L232">ngx_http_browser_variable</a></li>
<li><a href="#L541">ngx_http_modern_browser</a></li>
<li><a href="#L531">ngx_http_modern_browser_sort</a></li>
<li><a href="#L669">ngx_http_modern_browser_value</a></li>
<li><a href="#L386">ngx_http_msie_variable</a></li>
</ul>
 <h4>Macros defined</h4>
 <ul>
<li><a href="#L21">NGX_HTTP_ANCIENT_BROWSER</a></li>
<li><a href="#L20">NGX_HTTP_MODERN_BROWSER</a></li>
</ul>
 <h4>Source code</h4>

  <code><ol><li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * Copyright (C) Igor Sysoev<br/></li>
<li></span><span class="Comment"> * Copyright (C) Nginx, Inc.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="PreProc">#include </span><span class="Constant">&lt;ngx_config.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ngx_core.h&gt;<br/></li>
<li></span><span class="PreProc">#include </span><span class="Constant">&lt;ngx_http.h&gt;<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Comment">/*<br/></li>
<li></span><span class="Comment"> * The module can check browser versions conforming to the following formats:<br/></li>
<li></span><span class="Comment"> * X, X.X, X.X.X, and X.X.X.X.&nbsp; The maximum values of each format may be<br/></li>
<li></span><span class="Comment"> * 4000, 4000.99, 4000.99.99, and 4000.99.99.99.<br/></li>
<li></span><span class="Comment"> */<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><a id="L20">&#x200c;</a><span class="PreProc">#define&nbsp; <span class="linkable">NGX_HTTP_MODERN_BROWSER</span>&nbsp;&nbsp; </span><span class="Constant">0<br/></li>
<li><a id="L21">&#x200c;</a></span><span class="PreProc">#define&nbsp; <span class="linkable">NGX_HTTP_ANCIENT_BROWSER</span>&nbsp; </span><span class="Constant">1<br/></li>
<li></span><br/></li>
<li><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct</span> {<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; browser[<span class="Constant">12</span>];<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; skip;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add;<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name[<span class="Constant">12</span>];<br/></li>
<li><a id="L29">&#x200c;</a>} <span class="linkable">ngx_http_modern_browser_mask_t</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct</span> {<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; version;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; skip;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add;<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name[<span class="Constant">12</span>];<br/></li>
<li><a id="L37">&#x200c;</a>} <span class="linkable">ngx_http_modern_browser_t</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct</span> {<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; name;<br/></li>
<li>&nbsp; &nbsp; <a href="../ngx_http_variables.h.html#L25" title="http/ngx_http_variables.h:25">ngx_http_get_variable_pt</a>&nbsp; &nbsp; handler;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">uintptr_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; data;<br/></li>
<li><a id="L44">&#x200c;</a>} <span class="linkable">ngx_http_browser_variable_t</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">typedef</span> <span class="Type">struct</span> {<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_array.h.html#L22" title="core/ngx_array.h:22">ngx_array_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *modern_browsers;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_array.h.html#L22" title="core/ngx_array.h:22">ngx_array_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *ancient_browsers;<br/></li>
<li>&nbsp; &nbsp; <a href="../ngx_http_variables.h.html#L17" title="http/ngx_http_variables.h:17">ngx_http_variable_value_t</a>&nbsp; *modern_browser_value;<br/></li>
<li>&nbsp; &nbsp; <a href="../ngx_http_variables.h.html#L17" title="http/ngx_http_variables.h:17">ngx_http_variable_value_t</a>&nbsp; *ancient_browser_value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Type">unsigned</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; modern_unlisted_browsers:<span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; <span class="Type">unsigned</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; netscape4:<span class="Constant">1</span>;<br/></li>
<li><a id="L55">&#x200c;</a>} <span class="linkable">ngx_http_browser_conf_t</span>;<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L386" title="http/modules/ngx_http_browser_module.c:386">ngx_http_msie_variable</a>(<a href="../ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r,<br/></li>
<li>&nbsp; &nbsp; <a href="../ngx_http_variables.h.html#L17" title="http/ngx_http_variables.h:17">ngx_http_variable_value_t</a> *v, <span class="Type">uintptr_t</span> data);<br/></li>
<li><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L232" title="http/modules/ngx_http_browser_module.c:232">ngx_http_browser_variable</a>(<a href="../ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r,<br/></li>
<li>&nbsp; &nbsp; <a href="../ngx_http_variables.h.html#L17" title="http/ngx_http_variables.h:17">ngx_http_variable_value_t</a> *v, <span class="Type">uintptr_t</span> data);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a> <a href="#L258" title="http/modules/ngx_http_browser_module.c:258">ngx_http_browser</a>(<a href="../ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r,<br/></li>
<li>&nbsp; &nbsp; <a href="#L55" title="http/modules/ngx_http_browser_module.c:55">ngx_http_browser_conf_t</a> *cf);<br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a> <a href="#L400" title="http/modules/ngx_http_browser_module.c:400">ngx_http_browser_add_variable</a>(<a href="../../core/ngx_core.h.html#L13" title="core/ngx_core.h:13">ngx_conf_t</a> *cf);<br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> *<a href="#L421" title="http/modules/ngx_http_browser_module.c:421">ngx_http_browser_create_conf</a>(<a href="../../core/ngx_core.h.html#L13" title="core/ngx_core.h:13">ngx_conf_t</a> *cf);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L447" title="http/modules/ngx_http_browser_module.c:447">ngx_http_browser_merge_conf</a>(<a href="../../core/ngx_core.h.html#L13" title="core/ngx_core.h:13">ngx_conf_t</a> *cf, <span class="Type">void</span> *parent,<br/></li>
<li>&nbsp; &nbsp; <span class="Type">void</span> *child);<br/></li>
<li><span class="Type">static</span> <span class="Type">int</span> <a href="../../core/ngx_config.h.html#L74" title="core/ngx_config.h:74">ngx_libc_cdecl</a> <a href="#L531" title="http/modules/ngx_http_browser_module.c:531">ngx_http_modern_browser_sort</a>(<span class="Type">const</span> <span class="Type">void</span> *one,<br/></li>
<li>&nbsp; &nbsp; <span class="Type">const</span> <span class="Type">void</span> *two);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L541" title="http/modules/ngx_http_browser_module.c:541">ngx_http_modern_browser</a>(<a href="../../core/ngx_core.h.html#L13" title="core/ngx_core.h:13">ngx_conf_t</a> *cf, <a href="../../core/ngx_core.h.html#L19" title="core/ngx_core.h:19">ngx_command_t</a> *cmd,<br/></li>
<li>&nbsp; &nbsp; <span class="Type">void</span> *conf);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L633" title="http/modules/ngx_http_browser_module.c:633">ngx_http_ancient_browser</a>(<a href="../../core/ngx_core.h.html#L13" title="core/ngx_core.h:13">ngx_conf_t</a> *cf, <a href="../../core/ngx_core.h.html#L19" title="core/ngx_core.h:19">ngx_command_t</a> *cmd,<br/></li>
<li>&nbsp; &nbsp; <span class="Type">void</span> *conf);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L669" title="http/modules/ngx_http_browser_module.c:669">ngx_http_modern_browser_value</a>(<a href="../../core/ngx_core.h.html#L13" title="core/ngx_core.h:13">ngx_conf_t</a> *cf, <a href="../../core/ngx_core.h.html#L19" title="core/ngx_core.h:19">ngx_command_t</a> *cmd,<br/></li>
<li>&nbsp; &nbsp; <span class="Type">void</span> *conf);<br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<a href="#L694" title="http/modules/ngx_http_browser_module.c:694">ngx_http_ancient_browser_value</a>(<a href="../../core/ngx_core.h.html#L13" title="core/ngx_core.h:13">ngx_conf_t</a> *cf, <a href="../../core/ngx_core.h.html#L19" title="core/ngx_core.h:19">ngx_command_t</a> *cmd,<br/></li>
<li>&nbsp; &nbsp; <span class="Type">void</span> *conf);<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L82">&#x200c;</a><span class="Type">static</span> <a href="../../core/ngx_core.h.html#L19" title="core/ngx_core.h:19">ngx_command_t</a>&nbsp; <span class="linkable">ngx_http_browser_commands</span>[] = {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;modern_browser&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="../ngx_http_config.h.html#L41" title="http/ngx_http_config.h:41">NGX_HTTP_MAIN_CONF</a>|<a href="../ngx_http_config.h.html#L42" title="http/ngx_http_config.h:42">NGX_HTTP_SRV_CONF</a>|<a href="../ngx_http_config.h.html#L43" title="http/ngx_http_config.h:43">NGX_HTTP_LOC_CONF</a>|<a href="../../core/ngx_conf_file.h.html#L33" title="core/ngx_conf_file.h:33">NGX_CONF_TAKE12</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L541" title="http/modules/ngx_http_browser_module.c:541">ngx_http_modern_browser</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="../ngx_http_config.h.html#L52" title="http/ngx_http_config.h:52">NGX_HTTP_LOC_CONF_OFFSET</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;ancient_browser&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="../ngx_http_config.h.html#L41" title="http/ngx_http_config.h:41">NGX_HTTP_MAIN_CONF</a>|<a href="../ngx_http_config.h.html#L42" title="http/ngx_http_config.h:42">NGX_HTTP_SRV_CONF</a>|<a href="../ngx_http_config.h.html#L43" title="http/ngx_http_config.h:43">NGX_HTTP_LOC_CONF</a>|<a href="../../core/ngx_conf_file.h.html#L46" title="core/ngx_conf_file.h:46">NGX_CONF_1MORE</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L633" title="http/modules/ngx_http_browser_module.c:633">ngx_http_ancient_browser</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="../ngx_http_config.h.html#L52" title="http/ngx_http_config.h:52">NGX_HTTP_LOC_CONF_OFFSET</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;modern_browser_value&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="../ngx_http_config.h.html#L41" title="http/ngx_http_config.h:41">NGX_HTTP_MAIN_CONF</a>|<a href="../ngx_http_config.h.html#L42" title="http/ngx_http_config.h:42">NGX_HTTP_SRV_CONF</a>|<a href="../ngx_http_config.h.html#L43" title="http/ngx_http_config.h:43">NGX_HTTP_LOC_CONF</a>|<a href="../../core/ngx_conf_file.h.html#L23" title="core/ngx_conf_file.h:23">NGX_CONF_TAKE1</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L669" title="http/modules/ngx_http_browser_module.c:669">ngx_http_modern_browser_value</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="../ngx_http_config.h.html#L52" title="http/ngx_http_config.h:52">NGX_HTTP_LOC_CONF_OFFSET</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <a href="../../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;ancient_browser_value&quot;</span>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="../ngx_http_config.h.html#L41" title="http/ngx_http_config.h:41">NGX_HTTP_MAIN_CONF</a>|<a href="../ngx_http_config.h.html#L42" title="http/ngx_http_config.h:42">NGX_HTTP_SRV_CONF</a>|<a href="../ngx_http_config.h.html#L43" title="http/ngx_http_config.h:43">NGX_HTTP_LOC_CONF</a>|<a href="../../core/ngx_conf_file.h.html#L23" title="core/ngx_conf_file.h:23">NGX_CONF_TAKE1</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="#L694" title="http/modules/ngx_http_browser_module.c:694">ngx_http_ancient_browser_value</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="../ngx_http_config.h.html#L52" title="http/ngx_http_config.h:52">NGX_HTTP_LOC_CONF_OFFSET</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">NULL</span> },<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; <a href="../../core/ngx_conf_file.h.html#L87" title="core/ngx_conf_file.h:87">ngx_null_command</a><br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L116">&#x200c;</a><span class="Type">static</span> <a href="../ngx_http_config.h.html#L36" title="http/ngx_http_config.h:36">ngx_http_module_t</a>&nbsp; <span class="linkable">ngx_http_browser_module_ctx</span> = {<br/></li>
<li>&nbsp; &nbsp; <a href="#L400" title="http/modules/ngx_http_browser_module.c:400">ngx_http_browser_add_variable</a>,&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* preconfiguration */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* postconfiguration */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* create <a href="../../core/nginx.c.html#L202" title="core/nginx.c:202">main</a> configuration */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init <a href="../../core/nginx.c.html#L202" title="core/nginx.c:202">main</a> configuration */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* create server configuration */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* merge server configuration */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <a href="#L421" title="http/modules/ngx_http_browser_module.c:421">ngx_http_browser_create_conf</a>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* create location configuration */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L447" title="http/modules/ngx_http_browser_module.c:447">ngx_http_browser_merge_conf</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* merge location configuration */<br/></li>
<li></span>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L131">&#x200c;</a><a href="../../core/ngx_core.h.html#L12" title="core/ngx_core.h:12">ngx_module_t</a>&nbsp; <span class="linkable">ngx_http_browser_module</span> = {<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_conf_file.h.html#L99" title="core/ngx_conf_file.h:99">NGX_MODULE_V1</a>,<br/></li>
<li>&nbsp; &nbsp; &amp;<a href="#L116" title="http/modules/ngx_http_browser_module.c:116">ngx_http_browser_module_ctx</a>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* module context */<br/></li>
<li></span>&nbsp; &nbsp; <a href="#L82" title="http/modules/ngx_http_browser_module.c:82">ngx_http_browser_commands</a>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* module directives */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../ngx_http_config.h.html#L39" title="http/ngx_http_config.h:39">NGX_HTTP_MODULE</a>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Comment">/* module type */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init master */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init module */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init process */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* init thread */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* exit thread */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* exit process */<br/></li>
<li></span>&nbsp; &nbsp; <span class="Constant">NULL</span>,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/* exit master */<br/></li>
<li></span>&nbsp; &nbsp; <a href="../../core/ngx_conf_file.h.html#L100" title="core/ngx_conf_file.h:100">NGX_MODULE_V1_PADDING</a><br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L147">&#x200c;</a><span class="Type">static</span> <a href="#L29" title="http/modules/ngx_http_browser_module.c:29">ngx_http_modern_browser_mask_t</a>&nbsp; <span class="linkable">ngx_http_modern_browser_masks</span>[] = {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* Opera must be the first browser to check */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;Opera/7.50 (X11; FreeBSD i386; U)&nbsp; [en]&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;Mozilla/5.0 (X11; FreeBSD i386; U) Opera 7.50&nbsp; [en]&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;Mozilla/4.0 (compatible; MSIE 6.0; X11; FreeBSD i386) Opera 7.50&nbsp; [en]&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;Opera/8.0 (Windows NT 5.1; U; ru)&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0; en) Opera 8.0&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;Opera/9.01 (X11; FreeBSD 6 i386; U; en)&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; { <span class="Constant">&quot;opera&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<span class="Constant">&quot;Opera &quot;</span>) - <span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">&quot;Opera&quot;</span>},<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/* &quot;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)&quot; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; { <span class="Constant">&quot;msie&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<span class="Constant">&quot;Mozilla/4.0 (compatible; &quot;</span>) - <span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<span class="Constant">&quot;MSIE &quot;</span>) - <span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">&quot;MSIE &quot;</span>},<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.0.0) Gecko/20020610&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; ru-RU; rv:1.5) Gecko/20031006&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; ru-RU; rv:1.6) Gecko/20040206<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Firefox/0.8&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; ru-RU; rv:1.7.8)<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Gecko/20050511 Firefox/1.0.4&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;Mozilla/5.0 (X11; U; FreeBSD i386; en-US; rv:1.8.0.5) Gecko/20060729<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Firefox/1.5.0.5&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; { <span class="Constant">&quot;gecko&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<span class="Constant">&quot;Mozilla/5.0 (&quot;</span>) - <span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<span class="Constant">&quot;rv:&quot;</span>) - <span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">&quot;rv:&quot;</span>},<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X; ru-ru) AppleWebKit/125.2<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (KHTML, like Gecko) Safari/125.7&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;Mozilla/5.0 (SymbianOS/9.1; U; en-us) AppleWebKit/413<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (KHTML, like Gecko) Safari/413&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X; en) AppleWebKit/418<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (KHTML, like Gecko) Safari/417.9.3&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;Mozilla/5.0 (Macintosh; U; PPC Mac OS X; ru-ru) AppleWebKit/418.8<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (KHTML, like Gecko) Safari/419.3&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; { <span class="Constant">&quot;safari&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<span class="Constant">&quot;Mozilla/5.0 (&quot;</span>) - <span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<span class="Constant">&quot;Safari/&quot;</span>) - <span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">&quot;Safari/&quot;</span>},<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;Mozilla/5.0 (compatible; Konqueror/3.1; Linux)&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;Mozilla/5.0 (compatible; Konqueror/3.4; Linux) KHTML/3.4.2 (like Gecko)&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * &quot;Mozilla/5.0 (compatible; Konqueror/3.5; FreeBSD) KHTML/3.5.1<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (like Gecko)&quot;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; { <span class="Constant">&quot;konqueror&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<span class="Constant">&quot;Mozilla/5.0 (compatible; &quot;</span>) - <span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<span class="Constant">&quot;Konqueror/&quot;</span>) - <span class="Constant">1</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; <span class="Constant">&quot;Konqueror/&quot;</span>},<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; { <span class="Constant">&quot;&quot;</span>, <span class="Constant">0</span>, <span class="Constant">0</span>, <span class="Constant">&quot;&quot;</span> }<br/></li>
<li><br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><a id="L221">&#x200c;</a><span class="Type">static</span> <a href="#L44" title="http/modules/ngx_http_browser_module.c:44">ngx_http_browser_variable_t</a>&nbsp; <span class="linkable">ngx_http_browsers</span>[] = {<br/></li>
<li>&nbsp; &nbsp; { <a href="../../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;msie&quot;</span>), <a href="#L386" title="http/modules/ngx_http_browser_module.c:386">ngx_http_msie_variable</a>, <span class="Constant">0</span> },<br/></li>
<li>&nbsp; &nbsp; { <a href="../../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;modern_browser&quot;</span>), <a href="#L232" title="http/modules/ngx_http_browser_module.c:232">ngx_http_browser_variable</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L20" title="http/modules/ngx_http_browser_module.c:20">NGX_HTTP_MODERN_BROWSER</a> },<br/></li>
<li>&nbsp; &nbsp; { <a href="../../core/ngx_string.h.html#L40" title="core/ngx_string.h:40">ngx_string</a>(<span class="Constant">&quot;ancient_browser&quot;</span>), <a href="#L232" title="http/modules/ngx_http_browser_module.c:232">ngx_http_browser_variable</a>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L21" title="http/modules/ngx_http_browser_module.c:21">NGX_HTTP_ANCIENT_BROWSER</a> },<br/></li>
<li>&nbsp; &nbsp; { <a href="../../core/ngx_string.h.html#L41" title="core/ngx_string.h:41">ngx_null_string</a>, <span class="Constant">NULL</span>, <span class="Constant">0</span> }<br/></li>
<li>};<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L232">&#x200c;</a><span class="linkable">ngx_http_browser_variable</span>(<a href="../ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r, <a href="../ngx_http_variables.h.html#L17" title="http/ngx_http_variables.h:17">ngx_http_variable_value_t</a> *v,<br/></li>
<li>&nbsp; &nbsp; <span class="Type">uintptr_t</span> data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rc;<br/></li>
<li>&nbsp; &nbsp; <a href="#L55" title="http/modules/ngx_http_browser_module.c:55">ngx_http_browser_conf_t</a>&nbsp; *cf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; cf = <a href="../ngx_http_config.h.html#L58" title="http/ngx_http_config.h:58">ngx_http_get_module_loc_conf</a>(r, <a href="#L131" title="http/modules/ngx_http_browser_module.c:131">ngx_http_browser_module</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; rc = <a href="#L258" title="http/modules/ngx_http_browser_module.c:258">ngx_http_browser</a>(r, cf);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (data == <a href="#L20" title="http/modules/ngx_http_browser_module.c:20">NGX_HTTP_MODERN_BROWSER</a> &amp;&amp; rc == <a href="#L20" title="http/modules/ngx_http_browser_module.c:20">NGX_HTTP_MODERN_BROWSER</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *v = *cf-&gt;modern_browser_value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (data == <a href="#L21" title="http/modules/ngx_http_browser_module.c:21">NGX_HTTP_ANCIENT_BROWSER</a> &amp;&amp; rc == <a href="#L21" title="http/modules/ngx_http_browser_module.c:21">NGX_HTTP_ANCIENT_BROWSER</a>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *v = *cf-&gt;ancient_browser_value;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *v = <a href="../ngx_http_variables.c.html#L352" title="http/ngx_http_variables.c:352">ngx_http_variable_null_value</a>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a><br/></li>
<li><a id="L258">&#x200c;</a><span class="linkable">ngx_http_browser</span>(<a href="../ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r, <a href="#L55" title="http/modules/ngx_http_browser_module.c:55">ngx_http_browser_conf_t</a> *cf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Type">size_t</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len;<br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *name, *ua, *last, c;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *ancient;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i, version, ver, scale;<br/></li>
<li>&nbsp; &nbsp; <a href="#L37" title="http/modules/ngx_http_browser_module.c:37">ngx_http_modern_browser_t</a>&nbsp; *modern;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_in.user_agent == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (cf-&gt;modern_unlisted_browsers) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L20" title="http/modules/ngx_http_browser_module.c:20">NGX_HTTP_MODERN_BROWSER</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L21" title="http/modules/ngx_http_browser_module.c:21">NGX_HTTP_ANCIENT_BROWSER</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; ua = r-&gt;headers_in.user_agent-&gt;value.data;<br/></li>
<li>&nbsp; &nbsp; len = r-&gt;headers_in.user_agent-&gt;value.len;<br/></li>
<li>&nbsp; &nbsp; last = ua + len;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cf-&gt;modern_browsers) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; modern = cf-&gt;modern_browsers-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; cf-&gt;modern_browsers-&gt;nelts; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name = ua + modern[i].skip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (name &gt;= last) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name = (u_char *) <a href="../../core/ngx_string.h.html#L60" title="core/ngx_string.h:60">ngx_strstr</a>(name, modern[i].name);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (name == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L135" title="core/ngx_log.h:135">ngx_log_debug1</a>(<a href="../../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;browser: </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, name);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name += modern[i].add;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (name &gt;= last) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;version: </span><span class="Special">\&quot;%u</span><span class="Constant">i</span><span class="Special">\&quot;</span><span class="Constant"> </span><span class="Special">\&quot;%s\&quot;</span><span class="Constant">&quot;</span>, modern[i].version, name);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; version = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ver = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scale = <span class="Constant">1000000</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">while</span> (name &lt; last) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; c = *name++;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c &gt;= <span class="Constant">'0'</span> &amp;&amp; c &lt;= <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ver = ver * <span class="Constant">10</span> + (c - <span class="Constant">'0'</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c == <span class="Constant">'.'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; version += ver * scale;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;version: </span><span class="Special">\&quot;%u</span><span class="Constant">i</span><span class="Special">\&quot;</span><span class="Constant"> </span><span class="Special">\&quot;%u</span><span class="Constant">i</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; modern[i].version, version);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (version &gt; modern[i].version) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L20" title="http/modules/ngx_http_browser_module.c:20">NGX_HTTP_MODERN_BROWSER</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ver = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scale /= <span class="Constant">100</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">break</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; version += ver * scale;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_log.h.html#L138" title="core/ngx_log.h:138">ngx_log_debug2</a>(<a href="../../core/ngx_log.h.html#L30" title="core/ngx_log.h:30">NGX_LOG_DEBUG_HTTP</a>, r-&gt;connection-&gt;log, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;version: </span><span class="Special">\&quot;%u</span><span class="Constant">i</span><span class="Special">\&quot;</span><span class="Constant"> </span><span class="Special">\&quot;%u</span><span class="Constant">i</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; modern[i].version, version);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (version &gt;= modern[i].version) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L20" title="http/modules/ngx_http_browser_module.c:20">NGX_HTTP_MODERN_BROWSER</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L21" title="http/modules/ngx_http_browser_module.c:21">NGX_HTTP_ANCIENT_BROWSER</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (!cf-&gt;modern_unlisted_browsers) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L21" title="http/modules/ngx_http_browser_module.c:21">NGX_HTTP_ANCIENT_BROWSER</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cf-&gt;netscape4) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len &gt; <span class="Statement">sizeof</span>(<span class="Constant">&quot;Mozilla/4.72 &quot;</span>) - <span class="Constant">1<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; <a href="../../core/ngx_string.h.html#L53" title="core/ngx_string.h:53">ngx_strncmp</a>(ua, <span class="Constant">&quot;Mozilla/&quot;</span>, <span class="Statement">sizeof</span>(<span class="Constant">&quot;Mozilla/&quot;</span>) - <span class="Constant">1</span>) == <span class="Constant">0<br/></li>
<li></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; ua[<span class="Constant">8</span>] &gt; <span class="Constant">'0'</span> &amp;&amp; ua[<span class="Constant">8</span>] &lt; <span class="Constant">'5'</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L21" title="http/modules/ngx_http_browser_module.c:21">NGX_HTTP_ANCIENT_BROWSER</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cf-&gt;ancient_browsers) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; ancient = cf-&gt;ancient_browsers-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; cf-&gt;ancient_browsers-&gt;nelts; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (len &gt;= ancient[i].len<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;&amp; <a href="../../core/ngx_string.h.html#L60" title="core/ngx_string.h:60">ngx_strstr</a>(ua, ancient[i].data) != <span class="Constant">NULL</span>)<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L21" title="http/modules/ngx_http_browser_module.c:21">NGX_HTTP_ANCIENT_BROWSER</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cf-&gt;modern_unlisted_browsers) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="#L20" title="http/modules/ngx_http_browser_module.c:20">NGX_HTTP_MODERN_BROWSER</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="#L21" title="http/modules/ngx_http_browser_module.c:21">NGX_HTTP_ANCIENT_BROWSER</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L386">&#x200c;</a><span class="linkable">ngx_http_msie_variable</span>(<a href="../ngx_http.h.html#L16" title="http/ngx_http.h:16">ngx_http_request_t</a> *r, <a href="../ngx_http_variables.h.html#L17" title="http/ngx_http_variables.h:17">ngx_http_variable_value_t</a> *v,<br/></li>
<li>&nbsp; &nbsp; <span class="Type">uintptr_t</span> data)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (r-&gt;headers_in.msie) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *v = <a href="../ngx_http_variables.c.html#L354" title="http/ngx_http_variables.c:354">ngx_http_variable_true_value</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; *v = <a href="../ngx_http_variables.c.html#L352" title="http/ngx_http_variables.c:352">ngx_http_variable_null_value</a>;<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <a href="../../core/ngx_config.h.html#L78" title="core/ngx_config.h:78">ngx_int_t</a><br/></li>
<li><a id="L400">&#x200c;</a><span class="linkable">ngx_http_browser_add_variable</span>(<a href="../../core/ngx_core.h.html#L13" title="core/ngx_core.h:13">ngx_conf_t</a> *cf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L44" title="http/modules/ngx_http_browser_module.c:44">ngx_http_browser_variable_t</a>&nbsp;&nbsp; *var;<br/></li>
<li>&nbsp; &nbsp; <a href="../ngx_http_variables.h.html#L21" title="http/ngx_http_variables.h:21">ngx_http_variable_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *v;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (var = <a href="#L221" title="http/modules/ngx_http_browser_module.c:221">ngx_http_browsers</a>; var-&gt;name.len; var++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v = <a href="../ngx_http_variables.c.html#L359" title="http/ngx_http_variables.c:359">ngx_http_add_variable</a>(cf, &amp;var-&gt;name, <a href="../ngx_http_variables.h.html#L29" title="http/ngx_http_variables.h:29">NGX_HTTP_VAR_CHANGEABLE</a>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (v == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L30" title="core/ngx_core.h:30">NGX_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;get_handler = var-&gt;handler;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; v-&gt;data = var-&gt;data;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_core.h.html#L29" title="core/ngx_core.h:29">NGX_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">void</span> *<br/></li>
<li><a id="L421">&#x200c;</a><span class="linkable">ngx_http_browser_create_conf</span>(<a href="../../core/ngx_core.h.html#L13" title="core/ngx_core.h:13">ngx_conf_t</a> *cf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L55" title="http/modules/ngx_http_browser_module.c:55">ngx_http_browser_conf_t</a>&nbsp; *conf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; conf = <a href="../../core/ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>(cf-&gt;pool, <span class="Statement">sizeof</span>(<a href="#L55" title="http/modules/ngx_http_browser_module.c:55">ngx_http_browser_conf_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (conf == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <span class="Constant">NULL</span>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * <a href="../../event/modules/ngx_rtsig_module.c.html#L75" title="event/modules/ngx_rtsig_module.c:75">set</a> by <a href="../../core/ngx_palloc.c.html#L300" title="core/ngx_palloc.c:300">ngx_pcalloc</a>():<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp;&nbsp; conf-&gt;modern_browsers = NULL;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp;&nbsp; conf-&gt;ancient_browsers = NULL;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp;&nbsp; conf-&gt;modern_browser_value = NULL;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp;&nbsp; conf-&gt;ancient_browser_value = NULL;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp;&nbsp; conf-&gt;modern_unlisted_browsers = 0;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; *&nbsp; &nbsp;&nbsp; conf-&gt;netscape4 = 0;<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> conf;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L447">&#x200c;</a><span class="linkable">ngx_http_browser_merge_conf</span>(<a href="../../core/ngx_core.h.html#L13" title="core/ngx_core.h:13">ngx_conf_t</a> *cf, <span class="Type">void</span> *parent, <span class="Type">void</span> *child)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L55" title="http/modules/ngx_http_browser_module.c:55">ngx_http_browser_conf_t</a> *prev = parent;<br/></li>
<li>&nbsp; &nbsp; <a href="#L55" title="http/modules/ngx_http_browser_module.c:55">ngx_http_browser_conf_t</a> *conf = child;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; i, n;<br/></li>
<li>&nbsp; &nbsp; <a href="#L37" title="http/modules/ngx_http_browser_module.c:37">ngx_http_modern_browser_t</a>&nbsp; *browsers, *opera;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * At the merge the skip field is used to store the browser <a href="../../core/ngx_times.c.html#L23" title="core/ngx_times.c:23">slot</a>,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * it will be used in sorting and then will overwritten<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * with a real skip value.&nbsp; The zero value means Opera.<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (conf-&gt;modern_browsers == <span class="Constant">NULL</span> &amp;&amp; conf-&gt;modern_unlisted_browsers == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; conf-&gt;modern_browsers = prev-&gt;modern_browsers;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; conf-&gt;modern_unlisted_browsers = prev-&gt;modern_unlisted_browsers;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; } <span class="Statement">else</span> <span class="Statement">if</span> (conf-&gt;modern_browsers != <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; browsers = conf-&gt;modern_browsers-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; conf-&gt;modern_browsers-&gt;nelts; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (browsers[i].skip == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> found;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * Opera may contain MSIE string, so if Opera was not enumerated<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; * as modern browsers, then add it and <a href="../../event/modules/ngx_rtsig_module.c.html#L75" title="event/modules/ngx_rtsig_module.c:75">set</a> a unreachable version<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; opera = <a href="../../core/ngx_array.c.html#L48" title="core/ngx_array.c:48">ngx_array_push</a>(conf-&gt;modern_browsers);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (opera == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.h.html#L65" title="core/ngx_conf_file.h:65">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; opera-&gt;skip = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; opera-&gt;version = <span class="Constant">4001000000U</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; browsers = conf-&gt;modern_browsers-&gt;elts;<br/></li>
<li><br/></li>
<li><span class="Statement">found</span><span class="cUserCont">:<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_string.h.html#L227" title="core/ngx_string.h:227">ngx_qsort</a>(browsers, (<span class="Type">size_t</span>) conf-&gt;modern_browsers-&gt;nelts,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<a href="#L37" title="http/modules/ngx_http_browser_module.c:37">ngx_http_modern_browser_t</a>),<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L531" title="http/modules/ngx_http_browser_module.c:531">ngx_http_modern_browser_sort</a>);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; conf-&gt;modern_browsers-&gt;nelts; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; n = browsers[i].skip;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; browsers[i].skip = <a href="#L147" title="http/modules/ngx_http_browser_module.c:147">ngx_http_modern_browser_masks</a>[n].skip;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; browsers[i].add = <a href="#L147" title="http/modules/ngx_http_browser_module.c:147">ngx_http_modern_browser_masks</a>[n].add;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; (<span class="Type">void</span>) <a href="../../core/ngx_string.c.html#L33" title="core/ngx_string.c:33">ngx_cpystrn</a>(browsers[i].name,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L147" title="http/modules/ngx_http_browser_module.c:147">ngx_http_modern_browser_masks</a>[n].name, <span class="Constant">12</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (conf-&gt;ancient_browsers == <span class="Constant">NULL</span> &amp;&amp; conf-&gt;netscape4 == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; conf-&gt;ancient_browsers = prev-&gt;ancient_browsers;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; conf-&gt;netscape4 = prev-&gt;netscape4;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (conf-&gt;modern_browser_value == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; conf-&gt;modern_browser_value = prev-&gt;modern_browser_value;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (conf-&gt;modern_browser_value == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; conf-&gt;modern_browser_value = &amp;<a href="../ngx_http_variables.c.html#L354" title="http/ngx_http_variables.c:354">ngx_http_variable_true_value</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (conf-&gt;ancient_browser_value == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; conf-&gt;ancient_browser_value = prev-&gt;ancient_browser_value;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (conf-&gt;ancient_browser_value == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; conf-&gt;ancient_browser_value = &amp;<a href="../ngx_http_variables.c.html#L354" title="http/ngx_http_variables.c:354">ngx_http_variable_true_value</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.h.html#L64" title="core/ngx_conf_file.h:64">NGX_CONF_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">int</span> <a href="../../core/ngx_config.h.html#L74" title="core/ngx_config.h:74">ngx_libc_cdecl</a><br/></li>
<li><a id="L531">&#x200c;</a><span class="linkable">ngx_http_modern_browser_sort</span>(<span class="Type">const</span> <span class="Type">void</span> *one, <span class="Type">const</span> <span class="Type">void</span> *two)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L37" title="http/modules/ngx_http_browser_module.c:37">ngx_http_modern_browser_t</a> *first = (<a href="#L37" title="http/modules/ngx_http_browser_module.c:37">ngx_http_modern_browser_t</a> *) one;<br/></li>
<li>&nbsp; &nbsp; <a href="#L37" title="http/modules/ngx_http_browser_module.c:37">ngx_http_modern_browser_t</a> *second = (<a href="#L37" title="http/modules/ngx_http_browser_module.c:37">ngx_http_modern_browser_t</a> *) two;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> (first-&gt;skip - second-&gt;skip);<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L541">&#x200c;</a><span class="linkable">ngx_http_modern_browser</span>(<a href="../../core/ngx_core.h.html#L13" title="core/ngx_core.h:13">ngx_conf_t</a> *cf, <a href="../../core/ngx_core.h.html#L19" title="core/ngx_core.h:19">ngx_command_t</a> *cmd, <span class="Type">void</span> *conf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L55" title="http/modules/ngx_http_browser_module.c:55">ngx_http_browser_conf_t</a> *bcf = conf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; u_char&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; c;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; *value;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; i, n, version, ver, scale;<br/></li>
<li>&nbsp; &nbsp; <a href="#L37" title="http/modules/ngx_http_browser_module.c:37">ngx_http_modern_browser_t</a>&nbsp; &nbsp; &nbsp;&nbsp; *browser;<br/></li>
<li>&nbsp; &nbsp; <a href="#L29" title="http/modules/ngx_http_browser_module.c:29">ngx_http_modern_browser_mask_t</a>&nbsp; *mask;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; value = cf-&gt;args-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (cf-&gt;args-&gt;nelts == <span class="Constant">2</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../../core/ngx_string.h.html#L57" title="core/ngx_string.h:57">ngx_strcmp</a>(value[<span class="Constant">1</span>].data, <span class="Constant">&quot;unlisted&quot;</span>) == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bcf-&gt;modern_unlisted_browsers = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.h.html#L64" title="core/ngx_conf_file.h:64">NGX_CONF_OK</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.h.html#L65" title="core/ngx_conf_file.h:65">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (bcf-&gt;modern_browsers == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; bcf-&gt;modern_browsers = <a href="../../core/ngx_array.c.html#L13" title="core/ngx_array.c:13">ngx_array_create</a>(cf-&gt;pool, <span class="Constant">5</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<a href="#L37" title="http/modules/ngx_http_browser_module.c:37">ngx_http_modern_browser_t</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (bcf-&gt;modern_browsers == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.h.html#L65" title="core/ngx_conf_file.h:65">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; browser = <a href="../../core/ngx_array.c.html#L48" title="core/ngx_array.c:48">ngx_array_push</a>(bcf-&gt;modern_browsers);<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (browser == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.h.html#L65" title="core/ngx_conf_file.h:65">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; mask = <a href="#L147" title="http/modules/ngx_http_browser_module.c:147">ngx_http_modern_browser_masks</a>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (n = <span class="Constant">0</span>; mask[n].browser[<span class="Constant">0</span>] != <span class="Special">'\0'</span>; n++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../../core/ngx_string.c.html#L567" title="core/ngx_string.c:567">ngx_strcasecmp</a>(mask[n].browser, value[<span class="Constant">1</span>].data) == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">goto</span> found;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_conf_file.c.html#L909" title="core/ngx_conf_file.c:909">ngx_conf_log_error</a>(<a href="../../core/ngx_log.h.html#L17" title="core/ngx_log.h:17">NGX_LOG_EMERG</a>, cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;unknown browser name </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>, &amp;value[<span class="Constant">1</span>]);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.h.html#L65" title="core/ngx_conf_file.h:65">NGX_CONF_ERROR</a>;<br/></li>
<li><br/></li>
<li><span class="Statement">found</span><span class="cUserCont">:<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; <span class="Comment">/*<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * at this stage the skip field is used to store the browser <a href="../../core/ngx_times.c.html#L23" title="core/ngx_times.c:23">slot</a>,<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * it will be used in sorting in merge stage and then will overwritten<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; * with a real value<br/></li>
<li></span><span class="Comment">&nbsp; &nbsp;&nbsp; */<br/></li>
<li></span><br/></li>
<li>&nbsp; &nbsp; browser-&gt;skip = n;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; version = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; ver = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; scale = <span class="Constant">1000000</span>;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">0</span>; i &lt; value[<span class="Constant">2</span>].len; i++) {<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; c = value[<span class="Constant">2</span>].data[i];<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c &gt;= <span class="Constant">'0'</span> &amp;&amp; c &lt;= <span class="Constant">'9'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ver = ver * <span class="Constant">10</span> + (c - <span class="Constant">'0'</span>);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (c == <span class="Constant">'.'</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; version += ver * scale;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ver = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; scale /= <span class="Constant">100</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <a href="../../core/ngx_conf_file.c.html#L909" title="core/ngx_conf_file.c:909">ngx_conf_log_error</a>(<a href="../../core/ngx_log.h.html#L17" title="core/ngx_log.h:17">NGX_LOG_EMERG</a>, cf, <span class="Constant">0</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Constant">&quot;invalid browser version </span><span class="Special">\&quot;</span><span class="Constant">%V</span><span class="Special">\&quot;</span><span class="Constant">&quot;</span>, &amp;value[<span class="Constant">2</span>]);<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.h.html#L65" title="core/ngx_conf_file.h:65">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; version += ver * scale;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; browser-&gt;version = version;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.h.html#L64" title="core/ngx_conf_file.h:64">NGX_CONF_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L633">&#x200c;</a><span class="linkable">ngx_http_ancient_browser</span>(<a href="../../core/ngx_core.h.html#L13" title="core/ngx_core.h:13">ngx_conf_t</a> *cf, <a href="../../core/ngx_core.h.html#L19" title="core/ngx_core.h:19">ngx_command_t</a> *cmd, <span class="Type">void</span> *conf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L55" title="http/modules/ngx_http_browser_module.c:55">ngx_http_browser_conf_t</a> *bcf = conf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a>&nbsp;&nbsp; *value, *browser;<br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_config.h.html#L79" title="core/ngx_config.h:79">ngx_uint_t</a>&nbsp;&nbsp; i;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; value = cf-&gt;args-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">for</span> (i = <span class="Constant">1</span>; i &lt; cf-&gt;args-&gt;nelts; i++) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (<a href="../../core/ngx_string.h.html#L57" title="core/ngx_string.h:57">ngx_strcmp</a>(value[i].data, <span class="Constant">&quot;netscape4&quot;</span>) == <span class="Constant">0</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bcf-&gt;netscape4 = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">continue</span>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (bcf-&gt;ancient_browsers == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; bcf-&gt;ancient_browsers = <a href="../../core/ngx_array.c.html#L13" title="core/ngx_array.c:13">ngx_array_create</a>(cf-&gt;pool, <span class="Constant">4</span>,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">sizeof</span>(<a href="../../core/ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a>));<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (bcf-&gt;ancient_browsers == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.h.html#L65" title="core/ngx_conf_file.h:65">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; browser = <a href="../../core/ngx_array.c.html#L48" title="core/ngx_array.c:48">ngx_array_push</a>(bcf-&gt;ancient_browsers);<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">if</span> (browser == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.h.html#L65" title="core/ngx_conf_file.h:65">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; *browser = value[i];<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.h.html#L64" title="core/ngx_conf_file.h:64">NGX_CONF_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L669">&#x200c;</a><span class="linkable">ngx_http_modern_browser_value</span>(<a href="../../core/ngx_core.h.html#L13" title="core/ngx_core.h:13">ngx_conf_t</a> *cf, <a href="../../core/ngx_core.h.html#L19" title="core/ngx_core.h:19">ngx_command_t</a> *cmd, <span class="Type">void</span> *conf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L55" title="http/modules/ngx_http_browser_module.c:55">ngx_http_browser_conf_t</a> *bcf = conf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a>&nbsp; *value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; bcf-&gt;modern_browser_value = <a href="../../core/ngx_palloc.c.html#L120" title="core/ngx_palloc.c:120">ngx_palloc</a>(cf-&gt;pool,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; <span class="Statement">sizeof</span>(<a href="../ngx_http_variables.h.html#L17" title="http/ngx_http_variables.h:17">ngx_http_variable_value_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (bcf-&gt;modern_browser_value == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.h.html#L65" title="core/ngx_conf_file.h:65">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; value = cf-&gt;args-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; bcf-&gt;modern_browser_value-&gt;len = value[<span class="Constant">1</span>].len;<br/></li>
<li>&nbsp; &nbsp; bcf-&gt;modern_browser_value-&gt;valid = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; bcf-&gt;modern_browser_value-&gt;no_cacheable = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; bcf-&gt;modern_browser_value-&gt;not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; bcf-&gt;modern_browser_value-&gt;data = value[<span class="Constant">1</span>].data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.h.html#L64" title="core/ngx_conf_file.h:64">NGX_CONF_OK</a>;<br/></li>
<li>}<br/></li>
<li><br/></li>
<li><br/></li>
<li><span class="Type">static</span> <span class="Type">char</span> *<br/></li>
<li><a id="L694">&#x200c;</a><span class="linkable">ngx_http_ancient_browser_value</span>(<a href="../../core/ngx_core.h.html#L13" title="core/ngx_core.h:13">ngx_conf_t</a> *cf, <a href="../../core/ngx_core.h.html#L19" title="core/ngx_core.h:19">ngx_command_t</a> *cmd, <span class="Type">void</span> *conf)<br/></li>
<li>{<br/></li>
<li>&nbsp; &nbsp; <a href="#L55" title="http/modules/ngx_http_browser_module.c:55">ngx_http_browser_conf_t</a> *bcf = conf;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <a href="../../core/ngx_string.h.html#L19" title="core/ngx_string.h:19">ngx_str_t</a>&nbsp; *value;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; bcf-&gt;ancient_browser_value = <a href="../../core/ngx_palloc.c.html#L120" title="core/ngx_palloc.c:120">ngx_palloc</a>(cf-&gt;pool,<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">sizeof</span>(<a href="../ngx_http_variables.h.html#L17" title="http/ngx_http_variables.h:17">ngx_http_variable_value_t</a>));<br/></li>
<li>&nbsp; &nbsp; <span class="Statement">if</span> (bcf-&gt;ancient_browser_value == <span class="Constant">NULL</span>) {<br/></li>
<li>&nbsp; &nbsp; &nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.h.html#L65" title="core/ngx_conf_file.h:65">NGX_CONF_ERROR</a>;<br/></li>
<li>&nbsp; &nbsp; }<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; value = cf-&gt;args-&gt;elts;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; bcf-&gt;ancient_browser_value-&gt;len = value[<span class="Constant">1</span>].len;<br/></li>
<li>&nbsp; &nbsp; bcf-&gt;ancient_browser_value-&gt;valid = <span class="Constant">1</span>;<br/></li>
<li>&nbsp; &nbsp; bcf-&gt;ancient_browser_value-&gt;no_cacheable = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; bcf-&gt;ancient_browser_value-&gt;not_found = <span class="Constant">0</span>;<br/></li>
<li>&nbsp; &nbsp; bcf-&gt;ancient_browser_value-&gt;data = value[<span class="Constant">1</span>].data;<br/></li>
<li><br/></li>
<li>&nbsp; &nbsp; <span class="Statement">return</span> <a href="../../core/ngx_conf_file.h.html#L64" title="core/ngx_conf_file.h:64">NGX_CONF_OK</a>;<br/></li>
<li>}<br/></li>
</ol></code>
 </body>
</html>
